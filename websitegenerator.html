<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Memeportal — Website Generator</title>
<link rel="stylesheet" href="style.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<style>
  /* Generator Tool Specific Styles */
  :root { --p-bg: #050505; --p-card: #0e0e0e; --p-border: #222; --p-accent: #3b82f6; }
  .preview-pane { position: sticky; top: 20px; height: calc(100vh - 40px); overflow: hidden; display: flex; flex-direction: column; }
  #previewFrame { width: 100%; height: 100%; border: 0; background: #000; border-radius: 12px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
  
  .color-group { display: flex; gap: 10px; margin-bottom: 15px; }
  .color-field { flex: 1; display: flex; flex-direction: column; gap: 5px; font-size: 12px; color: #888; }
  input[type="color"] { width: 100%; height: 35px; padding: 0; border: none; border-radius: 6px; cursor: pointer; }
  
  /* Compact Gallery Dropzones */
  .gal-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
  .gal-drop { padding: 15px 5px; border: 1px dashed #333; text-align: center; border-radius: 8px; cursor: pointer; transition: .2s; background: #0a0a0a; }
  .gal-drop:hover { border-color: #666; background: #111; }
  .gal-drop.filled { border-color: var(--p-accent); background: rgba(59, 130, 246, 0.1); }
</style>
</head>
<body>
  <div id="site-header"></div>
  <script>
    (async function(){
      try{
        const host = document.getElementById('site-header');
        host.innerHTML = await (await fetch('nav.html')).text();
        const btn = host.querySelector('.menu-toggle');
        const menu = host.querySelector('#mobileMenu');
        if(!btn || !menu) return;
        const close=()=>{menu.setAttribute('hidden','');btn.setAttribute('aria-expanded','false');document.removeEventListener('click',away);};
        const open =()=>{menu.removeAttribute('hidden');btn.setAttribute('aria-expanded','true');setTimeout(()=>document.addEventListener('click',away),0);};
        const away = e => { if(!menu.contains(e.target)&&!btn.contains(e.target)) close(); };
        btn.addEventListener('click',e=>{e.stopPropagation();menu.hasAttribute('hidden')?open():close();});
        window.matchMedia('(min-width:900px)').addEventListener?.('change',e=>{ if(e.matches) close(); });
        close();
      }catch(e){ console.warn('nav load failed', e); }
    })();
  </script>

  <div class="app app--wide">
    <aside>
      <nav class="toc" id="wgToc"><div class="title">Quick menu</div><div class="row" id="wgTocLinks"></div></nav>

      <div class="card section" id="sec-basics">
        <h2>Identity</h2>
        <div class="grid">
          <div><label>Project Name</label><input id="p_name" type="text" value="Memeportal"></div>
          <div class="grid two">
            <div><label>Ticker</label><input id="p_ticker" type="text" value="$PORTAL"></div>
            <div><label>Chain</label><select id="p_chain"><option>Solana</option><option>Ethereum</option><option>Base</option><option>Sui</option></select></div>
          </div>
          <div><label>Tagline</label><input id="p_tag" type="text" value="The Gateway to Meme Culture"></div>
          <div><label>Contract Address</label><input id="p_ca" type="text" placeholder="Paste CA here"></div>
        </div>
      </div>

      <div class="card section" id="sec-design">
        <h2>Vibe & Theme</h2>
        <div class="grid">
          <div>
            <label>Theme Preset</label>
            <select id="theme_preset">
              <option value="polar" selected>Polar (Blue/Purple Glass)</option>
              <option value="magma">Magma (Red/Orange Heat)</option>
              <option value="venom">Venom (Green/Toxic)</option>
              <option value="cyber">Cyber (Pink/Neon)</option>
            </select>
          </div>

          <div class="color-group">
            <div class="color-field"><label>Glow 1</label><input id="c_accent" type="color" value="#7c3aed"></div>
            <div class="color-field"><label>Glow 2</label><input id="c_accent2" type="color" value="#06b6d4"></div>
            <div class="color-field"><label>Bg</label><input id="c_bg" type="color" value="#020205"></div>
          </div>
          
          <div class="flex">
             <input id="opt_noise" type="checkbox" checked><label for="opt_noise">Cinematic Grain</label>
          </div>
          <div class="flex">
             <input id="opt_orb" type="checkbox" checked><label for="opt_orb">Floating Orbs</label>
          </div>
        </div>
      </div>

      <div class="card section" id="sec-media">
        <h2>Assets</h2>
        <div class="grid">
          <div class="drop" id="logoDrop">
            <input id="logoFile" type="file" accept="image/*">
            <div><strong>Logo</strong> (PNG/SVG)<button class="btn ghost" id="logoBrowse">Browse</button></div>
          </div>
          <div class="drop" id="bannerDrop">
            <input id="bannerFile" type="file" accept="image/*">
            <div><strong>Hero Banner</strong> (Wide)<button class="btn ghost" id="bannerBrowse">Browse</button></div>
          </div>
        </div>
      </div>

      <div class="card section" id="sec-content">
        <h2>Content</h2>
        <div class="grid">
          <textarea id="s_about" rows="3">Memeportal is the ultimate destination for next-gen meme assets. Create, share, and vibe.</textarea>
          
          <label>Tokenomics</label>
          <div class="grid two">
            <div><label>Supply</label><input id="tok_supply" type="text" value="1,000,000,000"></div>
            <div><label>Tax</label><input id="tok_tax" type="text" value="0/0"></div>
            <div><label>Liquidity</label><input id="tok_liq" type="text" value="Burned"></div>
            <div><label>Mint</label><input id="tok_mint" type="text" value="Revoked"></div>
          </div>

          <div class="flex">
             <input id="opt_roadmap" type="checkbox" checked><label for="opt_roadmap">Enable Roadmap</label>
          </div>
          <textarea id="s_road" rows="3">Phase 1: Stealth Launch
Phase 2: Vibe & HODL
Phase 3: Moon Mission</textarea>

          <div class="flex">
             <input id="opt_gallery" type="checkbox" checked><label for="opt_gallery">Enable Meme Gallery</label>
          </div>
          <div class="tiny muted" style="margin-top:-10px; margin-bottom:5px;">Upload 1 to 4 images. Empty slots are ignored.</div>
          
          <div class="gal-grid">
            <div class="gal-drop" id="gal1Drop">
              <input id="gal1File" type="file" accept="image/*" hidden>
              <div class="tiny">Image 1</div>
            </div>
            <div class="gal-drop" id="gal2Drop">
              <input id="gal2File" type="file" accept="image/*" hidden>
              <div class="tiny">Image 2</div>
            </div>
            <div class="gal-drop" id="gal3Drop">
              <input id="gal3File" type="file" accept="image/*" hidden>
              <div class="tiny">Image 3</div>
            </div>
            <div class="gal-drop" id="gal4Drop">
              <input id="gal4File" type="file" accept="image/*" hidden>
              <div class="tiny">Image 4</div>
            </div>
          </div>

          <label>Links</label>
          <div class="grid two">
            <input id="l_tg" type="text" placeholder="Telegram URL" value="https://t.me/">
            <input id="l_x" type="text" placeholder="X / Twitter URL" value="https://x.com/">
            <input id="l_ds" type="text" placeholder="DexScreener URL" value="https://dexscreener.com/">
            <input id="l_buy" type="text" placeholder="Buy Link" value="https://raydium.io/">
          </div>
        </div>
      </div>

      <div class="card section" id="sec-actions">
        <h2>Export</h2>
        <div class="toolbar right">
          <button class="btn primary" id="refreshBtn">Update Preview</button>
          <button class="btn success" id="exportZip">Download Website (.ZIP)</button>
        </div>
      </div>
    </aside>

    <main>
      <div class="preview-pane">
        <iframe id="previewFrame"></iframe>
      </div>
    </main>
  </div>

<script>
(function(){
  const state = { 
    logo:null, banner:null, 
    gal1:null, gal2:null, gal3:null, gal4:null,
    logoUrl:'', bannerUrl:'', 
    gal1Url:'', gal2Url:'', gal3Url:'', gal4Url:'' 
  };
  
  const el = id => document.getElementById(id);
  const inputs = [
    'p_name','p_ticker','p_chain','p_tag','p_ca',
    'theme_preset','c_accent','c_accent2','c_bg','opt_noise','opt_orb',
    's_about','tok_supply','tok_tax','tok_liq','tok_mint',
    'opt_roadmap','s_road',
    'opt_gallery',
    'l_tg','l_x','l_ds','l_buy'
  ].reduce((acc,k)=>{ acc[k]=el(k); return acc; }, {});

  // Drag & Drop Helper
  const setupDrop = (dropId, fileId, key) => {
    const d = el(dropId), f = el(fileId);
    d.addEventListener('click', () => f.click());
    f.addEventListener('change', () => { 
      if(f.files[0]) {
        handleFile(f.files[0], key);
        d.classList.add('filled');
        const txt = d.querySelector('.tiny');
        if(txt) txt.textContent = f.files[0].name.slice(0, 10) + '...';
      }
    });
    d.addEventListener('dragover', e => { e.preventDefault(); d.style.borderColor='#fff'; });
    d.addEventListener('dragleave', () => d.style.borderColor='');
    d.addEventListener('drop', e => { 
      e.preventDefault(); 
      d.style.borderColor=''; 
      if(e.dataTransfer.files[0]) {
        handleFile(e.dataTransfer.files[0], key);
        d.classList.add('filled');
      }
    });
  };
  
  const handleFile = (file, key) => {
    state[key] = file;
    state[key+'Url'] = URL.createObjectURL(file);
    updatePreview();
  };
  
  setupDrop('logoDrop', 'logoFile', 'logo');
  setupDrop('bannerDrop', 'bannerFile', 'banner');
  setupDrop('gal1Drop', 'gal1File', 'gal1');
  setupDrop('gal2Drop', 'gal2File', 'gal2');
  setupDrop('gal3Drop', 'gal3File', 'gal3');
  setupDrop('gal4Drop', 'gal4File', 'gal4');

  // Theme Logic
  const THEMES = {
    polar: { a:'#7c3aed', a2:'#06b6d4', bg:'#020205', font:'Inter' },
    magma: { a:'#ef4444', a2:'#f59e0b', bg:'#0f0202', font:'Impact' },
    venom: { a:'#10b981', a2:'#84cc16', bg:'#020a02', font:'Space Mono' },
    cyber: { a:'#db2777', a2:'#d946ef', bg:'#0f020a', font:'Inter' }
  };

  el('theme_preset').addEventListener('change', (e) => {
    const t = THEMES[e.target.value];
    if(t) {
      el('c_accent').value = t.a;
      el('c_accent2').value = t.a2;
      el('c_bg').value = t.bg;
      updatePreview();
    }
  });

  function generateCSS(d) {
    let fontStack = "'Inter', sans-serif";
    if(d.theme === 'magma') fontStack = "'Impact', 'Inter', sans-serif";
    if(d.theme === 'venom') fontStack = "'Space Mono', monospace";
    
    return `
      :root {
        --primary: ${d.accent};
        --secondary: ${d.accent2};
        --bg: ${d.bg};
        --text: #ffffff;
        --glass-border: rgba(255, 255, 255, 0.08);
        --glass-bg: rgba(255, 255, 255, 0.03);
        --glass-shine: rgba(255, 255, 255, 0.05);
        --font-head: ${fontStack};
        --font-body: 'Inter', system-ui, sans-serif;
      }
      
      * { box-sizing: border-box; outline: none; -webkit-font-smoothing: antialiased; }
      html { scroll-behavior: smooth; }
      
      body { 
        margin: 0; 
        background-color: var(--bg); 
        color: var(--text); 
        font-family: var(--font-body); 
        overflow-x: hidden;
        min-height: 100vh;
      }

      .orb-container { position: fixed; inset: 0; overflow: hidden; pointer-events: none; z-index: -1; }
      .orb { position: absolute; border-radius: 50%; filter: blur(80px); opacity: 0.4; animation: float 20s infinite alternate; }
      .orb-1 { width: 50vw; height: 50vw; background: var(--primary); top: -10%; left: -10%; }
      .orb-2 { width: 40vw; height: 40vw; background: var(--secondary); bottom: -10%; right: -10%; animation-delay: -5s; }
      @keyframes float { 0% { transform: translate(0, 0); } 100% { transform: translate(30px, 50px); } }

      ${d.noise ? `.noise-overlay { position: fixed; inset: 0; pointer-events: none; z-index: 9999; opacity: 0.06; background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E"); }` : ''}

      h1, h2, h3 { margin: 0; font-family: var(--font-head); font-weight: 800; letter-spacing: -0.02em; }
      h1 { font-weight: 900; letter-spacing: -0.04em; }
      p { line-height: 1.6; color: rgba(255,255,255,0.7); margin: 0 0 20px 0; }
      
      .gradient-text {
        background: linear-gradient(135deg, #fff 30%, var(--primary) 100%);
        -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
      }

      .container { max-width: 1100px; margin: 0 auto; padding: 0 24px; position: relative; z-index: 2; }
      .section { padding: 100px 0; }
      
      nav { position: fixed; top: 24px; left: 0; right: 0; z-index: 1000; display: flex; justify-content: center; padding: 0 20px; }
      .nav-dock {
        background: rgba(10, 10, 10, 0.7); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1); padding: 8px 10px; border-radius: 999px;
        display: flex; align-items: center; justify-content: space-between;
        width: 100%; max-width: 900px; box-shadow: 0 10px 40px -10px rgba(0,0,0,0.5);
      }
      .nav-logo { display: flex; align-items: center; gap: 10px; font-weight: 700; color: #fff; text-decoration: none; padding-left: 12px; }
      .nav-logo img { height: 32px; width: auto; border-radius: 6px; }
      .nav-logo span { font-family: var(--font-head); }
      
      .nav-links { display: flex; align-items: center; gap: 4px; }
      .nav-item { color: rgba(255,255,255,0.7); text-decoration: none; padding: 8px 14px; border-radius: 999px; font-size: 0.85rem; font-weight: 600; transition: .2s; }
      .nav-item:hover { color: #fff; background: rgba(255,255,255,0.1); }
      
      .btn-nav { background: #fff; color: #000; padding: 8px 18px; border-radius: 999px; font-weight: 700; font-size: 0.85rem; text-decoration: none; transition: .2s; margin-left: 4px; }
      .btn-nav:hover { transform: scale(1.05); }

      .hero { min-height: 90vh; display: flex; align-items: center; justify-content: center; text-align: center; padding-top: 100px; }
      .hero-tag { display: inline-block; padding: 6px 16px; border-radius: 999px; background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); font-size: 0.85rem; color: var(--secondary); margin-bottom: 24px; font-weight: 600; text-transform: uppercase; }
      .hero h1 { font-size: clamp(3rem, 8vw, 6rem); line-height: 1; margin-bottom: 24px; }
      .hero-img-wrap { margin: 40px auto 0; position: relative; max-width: 600px; border-radius: 24px; overflow: hidden; border: 1px solid var(--glass-border); box-shadow: 0 0 80px -20px var(--primary); }
      
      .glass-card { background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 24px; padding: 32px; transition: .3s; position: relative; overflow: hidden; }
      .glass-card:hover { transform: translateY(-5px); border-color: rgba(255,255,255,0.2); box-shadow: 0 20px 40px -10px rgba(0,0,0,0.6); }

      .ca-box { display: inline-flex; align-items: center; gap: 12px; background: rgba(0,0,0,0.4); border: 1px solid var(--glass-border); padding: 12px 20px; border-radius: 12px; font-family: 'Space Mono', monospace; cursor: pointer; transition: .2s; margin-top: 20px; position: relative; }
      .ca-box:hover { background: rgba(255,255,255,0.08); border-color: rgba(255,255,255,0.3); }

      .bento-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-top: 40px; }
      .stat-label { font-size: 0.9rem; color: rgba(255,255,255,0.5); margin-bottom: 8px; }
      .stat-val { font-size: 1.8rem; font-weight: 700; color: #fff; font-family: var(--font-head); }

      .gallery-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
      .gallery-item { border-radius: 20px; overflow: hidden; border: 1px solid var(--glass-border); position: relative; aspect-ratio: 16/9; }
      .gallery-item img { width: 100%; height: 100%; object-fit: cover; transition: .4s; }
      .gallery-item:hover img { transform: scale(1.05); }

      .roadmap-step { display: flex; gap: 20px; margin-bottom: 20px; align-items: flex-start; }
      .step-num { background: var(--primary); color: #fff; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; flex-shrink: 0; box-shadow: 0 0 15px var(--primary); }

      footer { border-top: 1px solid var(--glass-border); background: rgba(0,0,0,0.2); padding: 60px 0; text-align: center; }
      .footer-links { display: flex; justify-content: center; gap: 24px; margin-bottom: 30px; }
      .footer-links a { color: var(--text); opacity: 0.6; text-decoration: none; font-weight: 600; transition: .2s; }
      .footer-links a:hover { opacity: 1; color: var(--primary); text-shadow: 0 0 10px var(--primary); }

      @media (max-width: 768px) {
        .nav-logo span { display: none; }
        .nav-dock { padding: 8px; }
        .hero h1 { font-size: 2.5rem; }
      }
    `;
  }

  function generateHTML(d) {
    const css = generateCSS(d);
    
    const logoImg = d.logoSrc ? `<img src="${d.logoSrc}" alt="Logo">` : `<div style="width:32px;height:32px;background:var(--primary);border-radius:6px;"></div>`;
    const heroImg = d.bannerSrc ? `<img src="${d.bannerSrc}" alt="Hero" style="width:100%; display:block;">` : ``; 
    
    // Gallery Logic
    let galleryHtml = '';
    if (d.gallery) {
      // Gather all potential images
      const images = [d.gal1Src, d.gal2Src, d.gal3Src, d.gal4Src].filter(Boolean);
      
      // If none uploaded, show placeholders
      if(images.length === 0) {
        images.push('https://placehold.co/600x400/111/444?text=Upload+Your+Meme');
        images.push('https://placehold.co/600x400/111/444?text=Community+Vibes');
        images.push('https://placehold.co/600x400/111/444?text=Art+Showcase');
      }

      const gridItems = images.map(src => `<div class="gallery-item"><img src="${src}" alt="Gallery Image"></div>`).join('');
      
      galleryHtml = `
      <section class="section">
        <div class="container">
          <h2 style="font-size:2.5rem; text-align:center; margin-bottom:40px;">Meme Gallery</h2>
          <div class="gallery-grid">
            ${gridItems}
          </div>
        </div>
      </section>`;
    }

    // Roadmap Logic
    let roadHtml = '';
    if (d.showRoad && d.roadmap) {
       const items = d.roadmap.split('\n').map((item, i) => `
        <div class="glass-card roadmap-step">
          <div class="step-num">${i+1}</div>
          <div>
            <h3 style="margin-bottom:5px; font-size:1.1rem;">${item.split(':')[0] || 'Phase '+(i+1)}</h3>
            <p style="margin:0; font-size:0.9rem;">${item.split(':')[1] || ''}</p>
          </div>
        </div>
       `).join('');
       roadHtml = `
       <section class="section">
         <div class="container" style="max-width:800px;">
           <h2 style="font-size:2.5rem; text-align:center; margin-bottom:40px;">Roadmap</h2>
           ${items}
         </div>
       </section>`;
    }

    return `
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>${d.name} (${d.ticker})</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Impact&family=Inter:wght@400;600;800;900&family=Space+Mono:wght@700&display=swap" rel="stylesheet">
  <style>${css}</style>
</head>
<body>
  ${d.noise ? '<div class="noise-overlay"></div>' : ''}
  ${d.orb ? '<div class="orb-container"><div class="orb orb-1"></div><div class="orb orb-2"></div></div>' : ''}

  <nav>
    <div class="nav-dock">
      <a href="#" class="nav-logo">${logoImg}<span>${d.name}</span></a>
      <div style="display:flex; align-items:center;">
        <div class="nav-links">
          ${d.tg ? `<a href="${d.tg}" target="_blank" class="nav-item">TG</a>` : ''}
          ${d.x ? `<a href="${d.x}" target="_blank" class="nav-item">X</a>` : ''}
        </div>
        ${d.buy ? `<a href="${d.buy}" target="_blank" class="btn-nav">Buy</a>` : ''}
      </div>
    </div>
  </nav>

  <section class="hero">
    <div class="container">
      <div class="hero-tag">Welcome to the portal</div>
      <h1 class="gradient-text">${d.tag}</h1>
      <p style="font-size:1.2rem; max-width:600px; margin:20px auto;">${d.about}</p>

      ${d.ca ? `
        <div class="ca-box" onclick="copyCA()">
          <span style="opacity:0.6;">CA:</span><span>${d.ca}</span>
          <div id="copyTooltip" style="position:absolute;top:-35px;left:50%;transform:translateX(-50%);background:var(--primary);font-size:12px;padding:4px 8px;border-radius:4px;opacity:0;transition:0.2s;pointer-events:none">Copied!</div>
        </div>` : ''}

      ${heroImg ? `<div class="hero-img-wrap">${heroImg}</div>` : ''}
    </div>
  </section>

  <section class="section">
    <div class="container">
      <h2 style="font-size:2.5rem; text-align:center;">Tokenomics</h2>
      <div class="bento-grid">
        <div class="glass-card">
          <div class="stat-label">Total Supply</div>
          <div class="stat-val gradient-text">${d.supply}</div>
        </div>
        <div class="glass-card">
          <div class="stat-label">Tax</div>
          <div class="stat-val" style="color:var(--secondary)">${d.tax}</div>
        </div>
        <div class="glass-card">
          <div class="stat-label">Liquidity</div>
          <div class="stat-val">${d.liq}</div>
        </div>
      </div>
    </div>
  </section>

  ${roadHtml}

  ${galleryHtml}

  <footer>
    <div class="container">
      <h2 class="gradient-text" style="font-size:3rem; margin-bottom:20px;">${d.ticker}</h2>
      <div class="footer-links">
        ${d.tg ? `<a href="${d.tg}" target="_blank">Telegram</a>` : ''}
        ${d.x ? `<a href="${d.x}" target="_blank">Twitter</a>` : ''}
        ${d.ds ? `<a href="${d.ds}" target="_blank">DexScreener</a>` : ''}
      </div>
      <p style="font-size:0.8rem; opacity:0.4;">© ${new Date().getFullYear()} ${d.name}. All rights reserved.</p>
    </div>
  </footer>

  <script>
    function copyCA(){
      navigator.clipboard.writeText("${d.ca}");
      const t=document.getElementById('copyTooltip');
      t.style.opacity='1'; t.style.top='-45px';
      setTimeout(()=>{t.style.opacity='0';t.style.top='-35px'},2000);
    }
  <\/script>
</body>
</html>`;
  }

  function collectData() {
    return {
      name: inputs.p_name.value,
      ticker: inputs.p_ticker.value,
      tag: inputs.p_tag.value,
      ca: inputs.p_ca.value,
      accent: inputs.c_accent.value,
      accent2: inputs.c_accent2.value,
      bg: inputs.c_bg.value,
      theme: el('theme_preset').value,
      noise: inputs.opt_noise.checked,
      orb: inputs.opt_orb.checked,
      
      showRoad: inputs.opt_roadmap.checked,
      roadmap: inputs.s_road.value,
      
      gallery: inputs.opt_gallery.checked,
      about: inputs.s_about.value,
      supply: inputs.tok_supply.value,
      tax: inputs.tok_tax.value,
      liq: inputs.tok_liq.value,
      mint: inputs.tok_mint.value,
      tg: inputs.l_tg.value,
      x: inputs.l_x.value,
      ds: inputs.l_ds.value,
      buy: inputs.l_buy.value,
      logoSrc: state.logoUrl,
      bannerSrc: state.bannerUrl,
      gal1Src: state.gal1Url,
      gal2Src: state.gal2Url,
      gal3Src: state.gal3Url,
      gal4Src: state.gal4Url
    };
  }

  function updatePreview() {
    const data = collectData();
    const html = generateHTML(data);
    const doc = el('previewFrame').contentDocument;
    doc.open(); doc.write(html); doc.close();
  }

  Object.values(inputs).forEach(i => i.addEventListener(i.type==='text'?'input':'change', updatePreview));
  el('refreshBtn').addEventListener('click', updatePreview);
  
  el('exportZip').addEventListener('click', async () => {
    const data = collectData();
    const zip = new JSZip();
    const assets = zip.folder('assets');
    
    // Save images to ZIP
    if(state.logo) { assets.file('logo'+ext(state.logo), state.logo); data.logoSrc='assets/logo'+ext(state.logo); }
    if(state.banner) { assets.file('banner'+ext(state.banner), state.banner); data.bannerSrc='assets/banner'+ext(state.banner); }
    if(state.gal1) { assets.file('gal1'+ext(state.gal1), state.gal1); data.gal1Src='assets/gal1'+ext(state.gal1); }
    if(state.gal2) { assets.file('gal2'+ext(state.gal2), state.gal2); data.gal2Src='assets/gal2'+ext(state.gal2); }
    if(state.gal3) { assets.file('gal3'+ext(state.gal3), state.gal3); data.gal3Src='assets/gal3'+ext(state.gal3); }
    if(state.gal4) { assets.file('gal4'+ext(state.gal4), state.gal4); data.gal4Src='assets/gal4'+ext(state.gal4); }

    zip.file("index.html", generateHTML(data));
    const b = await zip.generateAsync({type:"blob"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(b); a.download = `${data.name}_site.zip`; a.click();
  });
  
  const ext = f => f.name.substring(f.name.lastIndexOf('.'));
  updatePreview();
})();
</script>
</body>
</html>
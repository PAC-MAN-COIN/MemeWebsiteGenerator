<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Memeportal — Website Generator</title>
<link rel="stylesheet" href="style.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>
<body>
  <div id="site-header"></div>
  <script>
    (async()=>{try{
      const r=await fetch('nav.html');
      document.getElementById('site-header').innerHTML=await r.text();
    }catch(e){console.warn('nav load failed',e);}})();
  </script>

  <div class="app" style="grid-template-columns:420px minmax(0,1fr)">
    <aside>
      <!-- Basics -->
      <div class="card section">
        <h2>Project Basics</h2>
        <div class="grid">
          <div>
            <label>Project / Token name</label>
            <input id="p_name" type="text" placeholder="e.g. BeastLab" value="BeastLab">
          </div>
          <div class="two">
            <div>
              <label>Ticker</label>
              <input id="p_ticker" type="text" placeholder="e.g. BG" value="BG">
            </div>
            <div>
              <label>Chain</label>
              <select id="p_chain">
                <option>Solana</option><option>Ethereum</option><option>BNB Chain</option><option>Base</option><option>Polygon</option>
              </select>
            </div>
          </div>
          <div>
            <label>Contract address (CA)</label>
            <input id="p_ca" type="text" placeholder="Paste contract address">
          </div>
          <div>
            <label>Tagline</label>
            <input id="p_tag" type="text" placeholder="One-liner that sells the vibe" value="Meme tech from the jungle.">
          </div>

          <div class="two">
            <div>
              <label>Style preset</label>
              <select id="style_preset">
                <option value="serious" selected>Serious — clean</option>
                <option value="cartoony">Cartoony — bold outlines</option>
                <option value="neon">Neon — glow</option>
                <option value="glass">Glass — frosted</option>
                <option value="retro">Retro Terminal — CRT</option>
                <option value="zine">Paper Zine — cutout</option>
              </select>
            </div>
            <div>
              <label>Card radius</label>
              <input id="c_radius" type="range" min="6" max="28" value="18">
            </div>
          </div>

          <div class="two">
            <div>
              <label>Primary color</label>
              <input id="c_accent" type="color" value="#7c3aed">
            </div>
            <div>
              <label>Secondary color</label>
              <input id="c_accent2" type="color" value="#22d3ee">
            </div>
          </div>

          <div>
            <label>Background style</label>
            <select id="c_bg">
              <option value="memeportal" selected>Memeportal gradient</option>
              <option value="dark">Dark solid</option>
              <option value="radial">Radial glow</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Media -->
      <div class="card section">
        <h2>Media</h2>
        <div class="grid">
          <div class="drop" id="logoDrop">
            <input id="logoFile" type="file" accept="image/*">
            <div><strong>Logo</strong> PNG/SVG — transparent preferred. <button class="btn ghost" id="logoBrowse">Browse</button></div>
          </div>
          <div class="drop" id="bannerDrop">
            <input id="bannerFile" type="file" accept="image/*">
            <div><strong>Banner</strong> (wide) PNG/JPG/WebP. <button class="btn ghost" id="bannerBrowse">Browse</button></div>
          </div>
        </div>
      </div>

      <!-- Links -->
      <div class="card section">
        <h2>Links</h2>
        <div class="grid">
          <div><label>Website</label><input id="l_site" type="text" placeholder="https://"></div>
          <div class="two">
            <div><label>Twitter/X</label><input id="l_x" type="text" placeholder="https://x.com/..."></div>
            <div><label>Telegram</label><input id="l_tg" type="text" placeholder="https://t.me/..."></div>
          </div>
          <div class="two">
            <div><label>DexScreener</label><input id="l_ds" type="text" placeholder="https://dexscreener.com/..."></div>
            <div><label>Whitepaper</label><input id="l_wp" type="text" placeholder="https://...pdf"></div>
          </div>
        </div>
      </div>

      <!-- Sections -->
      <div class="card section">
        <h2>Sections</h2>
        <div class="grid">
          <div class="flex">
            <input id="s_about_e" type="checkbox" checked><label for="s_about_e" style="margin:0">About / Info</label>
          </div>
          <textarea id="s_about" rows="3">BeastLab is a memecoin with utility—clean branding, fair launch, and a community that ships.</textarea>

          <div class="flex">
            <input id="s_token_e" type="checkbox" checked><label for="s_token_e" style="margin:0">Tokenomics</label>
          </div>
          <div class="grid two">
            <div><label>Supply</label><input id="tok_supply" type="text" value="1,000,000,000"></div>
            <div><label>Decimals</label><input id="tok_dec" type="number" value="9"></div>
            <div><label>Buy Tax %</label><input id="tok_buy" type="number" value="0"></div>
            <div><label>Sell Tax %</label><input id="tok_sell" type="number" value="0"></div>
          </div>
          <details>
            <summary class="small">Allocations (optional)</summary>
            <textarea id="tok_alloc" class="tiny" rows="3">Liquidity:70, Community:20, Treasury:10</textarea>
          </details>

          <div class="flex" style="margin-top:6px">
            <input id="s_road_e" type="checkbox" checked><label for="s_road_e" style="margin:0">Roadmap</label>
          </div>
          <textarea id="s_road" rows="3">Phase 1 — Launch, socials, CMC/CG listing
Phase 2 — Partnerships, Meme contest, CEX listing
Phase 3 — Utilities drop, DAO experiments</textarea>

          <div class="flex">
            <input id="s_team_e" type="checkbox"><label for="s_team_e" style="margin:0">Team (optional)</label>
          </div>
          <textarea id="s_team" rows="2" placeholder="Each line Name — Role"></textarea>

          <div class="flex">
            <input id="s_disclaimer_e" type="checkbox" checked><label for="s_disclaimer_e" style="margin:0">Disclaimer</label>
          </div>
          <textarea id="s_disclaimer" rows="2">This is not financial advice. Cryptocurrency involves risk. Do your own research.</textarea>
        </div>
      </div>

      <!-- Advanced -->
      <div class="card section">
        <details>
          <summary class="small"><strong>Advanced</strong> (open for more control)</summary>
          <div class="grid" style="margin-top:10px">
            <div class="two">
              <div>
                <label>Heading font</label>
                <select id="adv_font_title">
                  <option value="Inter">Inter</option>
                  <option value="Impact">Impact</option>
                  <option value="Archivo Black">Archivo Black</option>
                  <option value="Space Grotesk">Space Grotesk</option>
                </select>
              </div>
              <div>
                <label>Body font</label>
                <select id="adv_font_body">
                  <option value="Inter" selected>Inter</option>
                  <option value="Space Grotesk">Space Grotesk</option>
                  <option value="IBM Plex Sans">IBM Plex Sans</option>
                  <option value="Atkinson Hyperlegible">Atkinson Hyperlegible</option>
                </select>
              </div>
            </div>

            <div class="two">
              <div>
                <label>Shadow strength</label>
                <input id="adv_shadow" type="range" min="0" max="1" step="0.05" value="0.35">
              </div>
              <div>
                <label>Gradient intensity</label>
                <input id="adv_grad" type="range" min="0" max="1" step="0.05" value="0.10">
              </div>
            </div>

            <div class="two">
              <div class="flex">
                <input id="adv_noise" type="checkbox">
                <label for="adv_noise" style="margin:0">Subtle noise overlay</label>
              </div>
              <div class="flex">
                <input id="adv_hero_flip" type="checkbox">
                <label for="adv_hero_flip" style="margin:0">Flip hero layout</label>
              </div>
            </div>

            <div class="two">
              <div>
                <label>Border style</label>
                <select id="adv_border">
                  <option value="soft" selected>Soft</option>
                  <option value="hard">Hard / solid</option>
                  <option value="dashed">Dashed</option>
                </select>
              </div>
              <div>
                <label>Button shape</label>
                <select id="adv_button">
                  <option value="rounded" selected>Rounded</option>
                  <option value="pill">Pill</option>
                  <option value="square">Square</option>
                </select>
              </div>
            </div>

            <div>
              <label>Max container width</label>
              <input id="adv_width" type="range" min="900" max="1400" step="10" value="1140">
            </div>
          </div>
        </details>
      </div>

      <!-- Actions -->
      <div class="card section">
        <div class="toolbar right">
          <button class="btn primary" id="refreshBtn">Update Preview</button>
          <button class="btn success" id="exportZip">Download ZIP</button>
        </div>
        <div class="footer">ZIP includes <strong>index.html</strong> and an <strong>assets/</strong> folder with your images.</div>
      </div>
    </aside>

    <main>
      <div class="card section" style="height:100%;display:grid;grid-template-rows:auto 1fr">
        <div class="kicker">Preview</div>
        <div id="preview" style="overflow:auto;border-radius:14px;border:1px solid var(--border)"></div>
      </div>
    </main>
  </div>

<script>
(function(){
  const state = { logo:null, banner:null, logoUrl:'', bannerUrl:'' };
  const el = id => document.getElementById(id);

  // controls
  const ids = [
    'p_name','p_ticker','p_chain','p_ca','p_tag',
    'style_preset','c_accent','c_accent2','c_bg','c_radius',
    'l_site','l_x','l_tg','l_ds','l_wp',
    's_about_e','s_about','s_token_e','tok_supply','tok_dec','tok_buy','tok_sell','tok_alloc',
    's_road_e','s_road','s_team_e','s_team','s_disclaimer_e','s_disclaimer',
    // advanced
    'adv_font_title','adv_font_body','adv_shadow','adv_grad','adv_noise','adv_hero_flip','adv_border','adv_button','adv_width'
  ];
  const inputs = ids.reduce((o,k)=> (o[k]=el(k),o), {});
  const preview = el('preview');
  const refreshBtn = el('refreshBtn');
  const exportBtn = el('exportZip');

  // media
  const logoFile = el('logoFile'), bannerFile = el('bannerFile');
  const logoBrowse=el('logoBrowse'), bannerBrowse=el('bannerBrowse');
  const logoDrop=el('logoDrop'), bannerDrop=el('bannerDrop');

  logoBrowse.addEventListener('click', ()=>logoFile.click());
  bannerBrowse.addEventListener('click', ()=>bannerFile.click());

  ['dragenter','dragover'].forEach(evt=>logoDrop.addEventListener(evt, e=>{e.preventDefault();logoDrop.classList.add('drag');}));
  ;['dragleave','drop'].forEach(evt=>logoDrop.addEventListener(evt, e=>{e.preventDefault();logoDrop.classList.remove('drag');}));
  logoDrop.addEventListener('drop', e=>{ const f=e.dataTransfer.files?.[0]; if(f){ setLogo(f); }});

  ['dragenter','dragover'].forEach(evt=>bannerDrop.addEventListener(evt, e=>{e.preventDefault();bannerDrop.classList.add('drag');}));
  ;['dragleave','drop'].forEach(evt=>bannerDrop.addEventListener(evt, e=>{e.preventDefault();bannerDrop.classList.remove('drag');}));
  bannerDrop.addEventListener('drop', e=>{ const f=e.dataTransfer.files?.[0]; if(f){ setBanner(f); }});

  logoFile.addEventListener('change', ()=>{ if(logoFile.files[0]) setLogo(logoFile.files[0]); });
  bannerFile.addEventListener('change', ()=>{ if(bannerFile.files[0]) setBanner(bannerFile.files[0]); });

  function setLogo(f){ state.logo=f; state.logoUrl=URL.createObjectURL(f); buildPreview(); }
  function setBanner(f){ state.banner=f; state.bannerUrl=URL.createObjectURL(f); buildPreview(); }

  // style presets -> advanced-aware vars
  function presetVars(type, vars){
    const base = {
      accent: vars.accent,
      accent2: vars.accent2,
      bg: vars.bg,
      radius: vars.radius,
      fontTitle: `800 36px '${inputs.adv_font_title.value}', system-ui`,
      fontBody: `15px '${inputs.adv_font_body.value}', system-ui`,
      shadowAmt: +inputs.adv_shadow.value,
      gradAmt: +inputs.adv_grad.value,
      noise: inputs.adv_noise.checked,
      heroFlip: inputs.adv_hero_flip.checked,
      borderStyle: inputs.adv_border.value,
      buttonShape: inputs.adv_button.value,
      maxWidth: +inputs.adv_width.value
    };

    if(type==='serious')  return { ...base, theme:'serious', decoration:'none' };
    if(type==='cartoony') return { ...base, theme:'cartoony', decoration:'cartoony', fontTitle:`900 38px 'Impact', Haettenschweiler, 'Arial Black', sans-serif` };
    if(type==='neon')     return { ...base, theme:'neon', decoration:'neon' };
    if(type==='glass')    return { ...base, theme:'glass', decoration:'glass' };
    if(type==='retro')    return { ...base, theme:'retro', decoration:'crt', accent:'#38ef7d', accent2:'#1bff6e' };
    return { ...base, theme:'zine', decoration:'zine', fontTitle:`900 34px 'Archivo Black', system-ui` }; // zine
  }

  function siteCss(v){
    const border =
      v.borderStyle==='hard' ? '1px solid #3a4263' :
      v.borderStyle==='dashed' ? '2px dashed #39405f' : '1px solid #22273a';

    const btnRadius =
      v.buttonShape==='pill' ? '999px' :
      v.buttonShape==='square' ? '8px' : '12px';

    const bgBase =
      v.bg==='memeportal'
        ? `radial-gradient(1200px 800px at 10% -10%, rgba(34,211,238, ${0.5*v.gradAmt}), transparent),
           radial-gradient(900px 700px at 120% 10%, rgba(124,58,237, ${0.6*v.gradAmt}), transparent),
           #0f1115`
        : v.bg==='radial'
          ? `radial-gradient(900px 700px at 120% 10%, rgba(124,58,237, ${0.9*v.gradAmt}), transparent), #0e1016`
          : `#0e1016`;

    const shadow = `0 ${8 + 16*v.shadowAmt}px ${20 + 40*v.shadowAmt}px rgba(0,0,0, ${0.25 + 0.35*v.shadowAmt})`;

    const glassExtra = v.decoration==='glass' ? `
      .card{background:rgba(16,19,28,.55);backdrop-filter:saturate(1.2) blur(10px)}
    ` : '';

    const neonExtra = v.decoration==='neon' ? `
      .glow{box-shadow:0 0 24px ${v.accent}66, inset 0 0 24px ${v.accent2}44}
      .btn{box-shadow:0 0 10px ${v.accent}55}
    ` : '';

    const crtExtra = v.decoration==='crt' ? `
      body{color:#caffd7}
      .card{background:#06180c}
      .container{filter:contrast(1.05) saturate(0.9)}
      .crt::after{content:'';pointer-events:none;position:fixed;inset:0;background:
        repeating-linear-gradient(0deg, rgba(0,0,0,.10), rgba(0,0,0,.10) 1px, transparent 1px, transparent 3px);}
    ` : '';

    const zineExtra = v.decoration==='zine' ? `
      .sticker{border:3px solid #000000aa; box-shadow:6px 6px 0 #00000077}
      .title-outline{-webkit-text-stroke:2px #222;color:#fff}
      .card{background:#0c0f17; box-shadow:${shadow}, inset 0 0 0 2px #00000055}
    ` : '';

    const cartoonyExtra = v.decoration==='cartoony' ? `
      .sticker{border:3px solid #00000088; box-shadow:4px 4px 0 #00000066}
      .title-outline{-webkit-text-stroke:2px #341b7a;color:#fff}
    ` : '';

    const noise = v.noise ? `
      body::before{content:'';position:fixed;inset:0;pointer-events:none;background:
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="60" height="60"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="2" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23n)" opacity=".025"/></svg>') repeat}
    ` : '';

    const heroGrid = v.heroFlip ? '1fr 420px' : '420px 1fr';

    return `
:root{--accent:${v.accent};--accent2:${v.accent2};--radius:${v.radius}px;--border:#22273a;--card:#10131c;--muted:#8892a6;--text:#e6e9ef}
*{box-sizing:border-box}
body{margin:0;color:var(--text);background:${bgBase};font:${v.fontBody}}
${noise}
.container{max-width:${v.maxWidth}px;margin:0 auto;padding:20px}
.card{background:var(--card);border:${border};border-radius:var(--radius);box-shadow:${shadow}}
.btn{display:inline-flex;align-items:center;gap:8px;border:1px solid #2b3352;background:#0f1424;color:#fff;padding:10px 14px;border-radius:${btnRadius};text-decoration:none;font-weight:800}
.btn:hover{border-color:#39436c}
.hero{position:relative;overflow:hidden;border-radius:calc(var(--radius) + 6px)}
.hero .inner{display:grid;grid-template-columns:${heroGrid};gap:24px;align-items:center;padding:28px}
.hero .badge{display:inline-block;background:linear-gradient(90deg,var(--accent),var(--accent2));-webkit-background-clip:text;background-clip:text;color:transparent;font-weight:900}
.hero h1{font:${v.fontTitle};margin:6px 0 4px}
.hero p{color:var(--muted);margin:0 0 12px}
.hero .cta{display:flex;gap:10px;flex-wrap:wrap}
.hero .gfx{position:absolute;inset:auto -80px -80px auto;opacity:.6;filter:blur(40px); pointer-events:none}
.split{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.section{padding:16px}
.h2{font-size:12px;letter-spacing:.2em;text-transform:uppercase;color:#9aa6c6;margin:0 0 10px}
.list{display:grid;gap:10px}
.kpi{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
.kpi .item{padding:12px;border-radius:12px;border:1px solid var(--border);background:#0b0f17}
.kpi .item .t{font-size:12px;color:#9aa6c6}
.kpi .item .v{font-size:18px;font-weight:900;background:linear-gradient(90deg,var(--accent),var(--accent2));-webkit-background-clip:text;background-clip:text;color:transparent}
.tokenomics{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
.tokenomics .card{padding:14px}
.timeline{position:relative;padding-left:22px}
.timeline::before{content:'';position:absolute;left:10px;top:0;bottom:0;width:2px;background:linear-gradient(var(--accent),var(--accent2))}
.timeline .step{position:relative;margin:10px 0;padding:10px 12px;background:#0b0f17;border:1px solid var(--border);border-radius:12px}
.timeline .step::before{content:'';position:absolute;left:-6px;top:12px;width:10px;height:10px;border-radius:999px;background:linear-gradient(90deg,var(--accent),var(--accent2))}
.footer{display:flex;justify-content:space-between;align-items:center;padding:14px 0;color:#9aa6c6}
.logo{width:40px;height:40px;border-radius:12px;background:conic-gradient(from 210deg,var(--accent),var(--accent2))}
img.banner{width:100%;height:260px;object-fit:cover;border-radius:calc(var(--radius) + 6px);border:1px solid var(--border)}
a{color:#c8d2ff}
@media (max-width:900px){.hero .inner{grid-template-columns:1fr}.split{grid-template-columns:1fr}}
${glassExtra}${neonExtra}${crtExtra}${zineExtra}${cartoonyExtra}
`; }

  function siteHtml(data){
    const allocations = parseAllocations(data.tokAlloc)
      .map(a=>`<div class="card"><div class="t">${esc(a.k)}</div><div class="v">${esc(a.v)}%</div></div>`).join('');
    const roadmap = (data.road||'').split('\n').filter(Boolean)
      .map(line=>`<div class="step">${esc(line)}</div>`).join('');
    const teamList = (data.team||'').split('\n').filter(Boolean)
      .map(line=>`<li>${esc(line)}</li>`).join('');

    return `<!DOCTYPE html><html lang="en"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>${esc(data.name)} — ${esc(data.ticker)}</title>
<style>${siteCss(data.vars)}</style>
</head><body class="${data.vars.decoration==='crt'?'crt':''}">
  <div class="container">
    <header class="section" style="display:flex;justify-content:space-between;align-items:center">
      <div style="display:flex;align-items:center;gap:12px">
        <div class="logo ${data.vars.decoration==='cartoony'?'sticker':''}"></div>
        <div>
          <div class="h2" style="margin:0">${esc(data.ticker)} on ${esc(data.chain)}</div>
          <div style="font-weight:900;font-size:18px" class="${data.vars.decoration==='cartoony'?'title-outline':''}">${esc(data.name)}</div>
        </div>
      </div>
      <div class="kpi" style="grid-template-columns:repeat(2,auto);gap:8px">
        ${data.links.ds?`<a class="btn" href="${esc(data.links.ds)}">DexScreener</a>`:''}
        ${data.links.tg?`<a class="btn" href="${esc(data.links.tg)}">Telegram</a>`:''}
      </div>
    </header>

    ${data.bannerSrc? `<img src="${esc(data.bannerSrc)}" class="banner ${data.vars.decoration==='neon'?'glow':''}" alt="Banner">`:''}

    <section class="hero card section" style="margin-top:14px">
      <div class="inner">
        <div>
          <div class="badge">${esc(data.ticker)} / ${esc(data.chain)}</div>
          <h1 class="${data.vars.decoration==='cartoony'?'title-outline':''}">${esc(data.name)}</h1>
          <p>${esc(data.tagline)}</p>
          ${data.ca? `<div class="kpi" style="grid-template-columns:1fr"><div class="item"><div class="t">CA</div><div class="v" style="word-break:break-all">${esc(data.ca)}</div></div></div>`:''}
          <div class="cta" style="margin-top:10px">
            ${data.links.site? `<a class="btn" href="${esc(data.links.site)}">Website</a>`:''}
            ${data.links.x? `<a class="btn" href="${esc(data.links.x)}">Twitter/X</a>`:''}
            ${data.links.wp? `<a class="btn" href="${esc(data.links.wp)}">Whitepaper</a>`:''}
          </div>
        </div>
        <div style="justify-self:end;align-self:center">
          ${data.logoSrc? `<img src="${esc(data.logoSrc)}" alt="Logo" style="width:180px;height:180px;object-fit:contain;border-radius:18px;border:1px solid var(--border);background:#0b0f17;padding:12px" class="${data.vars.decoration==='cartoony'?'sticker':''}">`:
            `<div style="width:180px;height:180px;border-radius:18px;border:1px dashed var(--border);display:grid;place-items:center;color:#9aa6c6">Logo</div>`}
        </div>
      </div>
      <svg class="gfx" width="420" height="420" viewBox="0 0 420 420" fill="none" xmlns="http://www.w3.org/2000/svg">
        <defs><linearGradient id="g1" x1="0" x2="1" y1="0" y2="1"><stop stop-color="${data.vars.accent}"/><stop offset="1" stop-color="${data.vars.accent2}"/></linearGradient></defs>
        <path d="M320 10c40 40 80 120 80 170s-40 90-90 130-120 70-170 50-90-90-80-150S120 70 180 40s100-30 140-30z" fill="url(#g1)" opacity="0.25"/>
      </svg>
    </section>

    <section class="split" style="margin-top:14px">
      ${data.aboutEnabled? `
      <div class="card section">
        <div class="h2">About</div>
        <div>${nl2br(esc(data.about))}</div>
      </div>`:''}

      ${data.tokenEnabled? `
      <div class="card section">
        <div class="h2">Tokenomics</div>
        <div class="tokenomics">
          <div class="card"><div class="t">Supply</div><div class="v">${esc(data.supply)}</div></div>
          <div class="card"><div class="t">Decimals</div><div class="v">${esc(data.dec)}</div></div>
          <div class="card"><div class="t">Buy Tax</div><div class="v">${esc(data.buy)}%</div></div>
          <div class="card"><div class="t">Sell Tax</div><div class="v">${esc(data.sell)}%</div></div>
          ${allocations}
        </div>
      </div>`:''}
    </section>

    ${data.roadEnabled? `
    <section class="card section" style="margin-top:14px">
      <div class="h2">Roadmap</div>
      <div class="timeline">${roadmap}</div>
    </section>`:''}

    ${data.teamEnabled? `
    <section class="card section" style="margin-top:14px">
      <div class="h2">Team</div>
      <ul class="list">${teamList}</ul>
    </section>`:''}

    ${data.disclaimerEnabled? `
    <footer class="footer">
      <div>© ${new Date().getFullYear()} ${esc(data.name)} — ${esc(data.ticker)}</div>
      <div>${esc(data.disclaimer)}</div>
    </footer>`:''}
  </div>
</body></html>`;
  }

  // helpers
  const esc = s => String(s||'').replace(/[&<>"]/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m]));
  const nl2br = s => s.replace(/\n/g,'<br>');
  function parseAllocations(str){
    return (str||'').split(',').map(s=>s.trim()).filter(Boolean).map(s=>{
      const m=s.split(':'); return {k:(m[0]||'').trim(), v:(m[1]||'').trim()};
    }).filter(x=>x.k && x.v);
  }

  function collect(){
    const vars = presetVars(inputs.style_preset.value, {
      accent: inputs.c_accent.value,
      accent2: inputs.c_accent2.value,
      bg: inputs.c_bg.value,
      radius: +inputs.c_radius.value
    });

    return {
      name: inputs.p_name.value.trim(),
      ticker: inputs.p_ticker.value.trim(),
      chain: inputs.p_chain.value,
      ca: inputs.p_ca.value.trim(),
      tagline: inputs.p_tag.value.trim(),
      vars,
      links: {
        site: inputs.l_site.value.trim(),
        x: inputs.l_x.value.trim(),
        tg: inputs.l_tg.value.trim(),
        ds: inputs.l_ds.value.trim(),
        wp: inputs.l_wp.value.trim()
      },
      aboutEnabled: inputs.s_about_e.checked,
      about: inputs.s_about.value,
      tokenEnabled: inputs.s_token_e.checked,
      supply: inputs.tok_supply.value, dec: inputs.tok_dec.value,
      buy: inputs.tok_buy.value, sell: inputs.tok_sell.value,
      tokAlloc: inputs.tok_alloc.value,
      roadEnabled: inputs.s_road_e.checked, road: inputs.s_road.value,
      teamEnabled: inputs.s_team_e.checked, team: inputs.s_team.value,
      disclaimerEnabled: inputs.s_disclaimer_e.checked, disclaimer: inputs.s_disclaimer.value,
      logoSrc: state.logoUrl, bannerSrc: state.bannerUrl
    };
  }

  function buildPreview(){ preview.innerHTML = siteHtml(collect()); }

  // live update
  Object.values(inputs).forEach(i=>{
    i.addEventListener('input', buildPreview);
    i.addEventListener('change', buildPreview);
  });
  buildPreview();

  // export
  exportBtn.addEventListener('click', async ()=>{
    const data = collect();
    const zip = new JSZip();
    const assets = zip.folder('assets');
    let logoName='', bannerName='';
    if(state.logo){ logoName = 'logo' + ext(state.logo.name); assets.file(logoName, state.logo); }
    if(state.banner){ bannerName = 'banner' + ext(state.banner.name); assets.file(bannerName, state.banner); }

    const html = siteHtml({
      ...data,
      logoSrc: logoName ? 'assets/'+logoName : '',
      bannerSrc: bannerName ? 'assets/'+bannerName : ''
    });
    zip.file('index.html', html);

    const content = await zip.generateAsync({type:'blob'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(content);
    a.download = (data.ticker||'site')+'_site.zip';
    a.click();
  });
  const ext = n => (n.toLowerCase().match(/\.[a-z0-9]+$/)||['.png'])[0];

  // manual refresh
  refreshBtn.addEventListener('click', buildPreview);
})();
</script>
</body>
</html>

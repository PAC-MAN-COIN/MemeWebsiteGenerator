<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Memeportal â€” Proof of Work Generator</title>
<link rel="stylesheet" href="style.css" />
<style>
  /* Tool specific styling for the preview area */
  .preview-container {
    display: flex;
    justify-content: center;
    align-items: center;
    background: #050505;
    border: 1px solid var(--panel-border);
    border-radius: 16px;
    padding: 20px;
    box-shadow: inset 0 0 50px rgba(0,0,0,0.5);
    min-height: 400px;
  }
  
  canvas {
    max-width: 100%;
    height: auto;
    border-radius: 12px;
    box-shadow: 0 20px 50px rgba(0,0,0,0.6);
  }
</style>
</head>
<body>
  <div id="site-header"></div>
  <script>
    async function loadNav(){
      try{
        const h=document.getElementById('site-header');
        h.innerHTML=await(await fetch('nav.html')).text();
        const btn=h.querySelector('.menu-toggle'), menu=h.querySelector('#mobileMenu');
        if(btn&&menu){
          const close=()=>{menu.setAttribute('hidden','');btn.setAttribute('aria-expanded','false');document.removeEventListener('click',clickAway);}
          const open=()=>{menu.removeAttribute('hidden');btn.setAttribute('aria-expanded','true');setTimeout(()=>document.addEventListener('click',clickAway),0);}
          const clickAway=e=>{if(!menu.contains(e.target)&&!btn.contains(e.target))close();}
          btn.addEventListener('click',e=>{e.stopPropagation();if(menu.hasAttribute('hidden'))open();else close();});
        }
      }catch(e){}
    }
    loadNav();
  </script>

  <div class="app">
    <aside>
      <div class="card section">
        <h2>1. Branding</h2>
        <div class="drop" id="logoDrop">
          <input id="logoInput" type="file" accept="image/*">
          <strong>Upload Token Logo</strong>
          <div class="tiny muted">PNG/JPG (Transparent is best)</div>
        </div>
      </div>

      <div class="card section">
        <h2>2. Milestones (Updates)</h2>
        <div class="grid">
            <div>
                <label>Title</label>
                <input type="text" id="cardTitle" value="DEV UPDATE">
            </div>
            <div>
                <label>Point 1</label>
                <input type="text" id="line1" placeholder="e.g. DexScreener Paid">
            </div>
            <div>
                <label>Point 2</label>
                <input type="text" id="line2" placeholder="e.g. Calls Booked">
            </div>
            <div>
                <label>Point 3</label>
                <input type="text" id="line3" placeholder="e.g. Website Live">
            </div>
        </div>
      </div>

      <div class="card section">
        <h2>3. Styling</h2>
        <div class="grid two">
            <div>
                <label>Accent Color</label>
                <input type="color" id="accentColor" value="#10b981" style="width:100%">
            </div>
            <div>
                <label>Background</label>
                <select id="bgStyle">
                    <option value="dark">Void Dark</option>
                    <option value="midnight">Midnight Blue</option>
                    <option value="forest">Deep Forest</option>
                </select>
            </div>
        </div>
      </div>

      <div class="card section" style="margin-top:auto">
        <button class="btn primary" id="downloadBtn" style="width:100%; height:50px; font-size:16px;">Download Card</button>
      </div>
    </aside>

    <main>
        <div class="wrap">
            <div style="margin-bottom: 24px;">
                <a href="index.html" style="color: #64748b; font-size: 13px; display:flex; gap:6px; align-items:center; margin-bottom:10px;">&larr; Back to Tools</a>
                <h1 style="font-size: 32px;">Proof of Work Generator</h1>
                <p style="color: #94a3b8;">Instantly generate professional update cards to stop FUD and build hype.</p>
            </div>

            <div class="preview-container fade-in">
                <canvas id="canvas" width="1200" height="675"></canvas>
            </div>
        </div>
    </main>
  </div>

<script>
window.addEventListener('load', () => {
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    
    // Inputs
    const logoInput = document.getElementById('logoInput');
    const logoDrop = document.getElementById('logoDrop');
    const titleIn = document.getElementById('cardTitle');
    const l1 = document.getElementById('line1');
    const l2 = document.getElementById('line2');
    const l3 = document.getElementById('line3');
    const colorIn = document.getElementById('accentColor');
    const bgSelect = document.getElementById('bgStyle');
    const downloadBtn = document.getElementById('downloadBtn');

    let loadedLogo = null;

    // --- Drawing Engine ---
    function draw() {
        const w = canvas.width;
        const h = canvas.height;
        const accent = colorIn.value;
        
        // 1. Background
        const bgType = bgSelect.value;
        const grad = ctx.createLinearGradient(0, 0, 0, h);
        
        if(bgType === 'dark') {
            grad.addColorStop(0, '#1a1a1a');
            grad.addColorStop(1, '#050505');
        } else if (bgType === 'midnight') {
            grad.addColorStop(0, '#1e293b');
            grad.addColorStop(1, '#020617');
        } else if (bgType === 'forest') {
            grad.addColorStop(0, '#0f392b');
            grad.addColorStop(1, '#020a05');
        }
        ctx.fillStyle = grad;
        ctx.fillRect(0,0,w,h);

        // 2. Accent Glow (Top Right)
        const glow = ctx.createRadialGradient(w, 0, 0, w, 0, 600);
        glow.addColorStop(0, `${accent}40`); // 40 = ~25% opacity hex
        glow.addColorStop(1, 'transparent');
        ctx.fillStyle = glow;
        ctx.fillRect(0,0,w,h);

        // 3. Accent Bar (Left side)
        ctx.fillStyle = accent;
        ctx.fillRect(40, 60, 8, h - 120);

        // 4. Header (Logo & Title)
        let contentX = 100;
        let contentY = 120;

        if (loadedLogo) {
            const size = 100;
            // Draw logo image
            ctx.save();
            // Drop shadow for logo
            ctx.shadowColor = 'rgba(0,0,0,0.5)';
            ctx.shadowBlur = 20;
            const aspect = loadedLogo.width / loadedLogo.height;
            let drawW = size;
            let drawH = size;
            if (aspect > 1) drawH = size / aspect;
            else drawW = size * aspect;
            
            ctx.drawImage(loadedLogo, contentX, contentY - 60, drawW, drawH);
            ctx.restore();
            contentX += drawW + 30; // Push text over
        }

        // Project Title
        ctx.fillStyle = '#ffffff';
        ctx.font = 'bold 50px "Inter", sans-serif';
        ctx.textBaseline = 'middle';
        ctx.fillText(titleIn.value.toUpperCase(), contentX, contentY - 10);

        // Subtitle (Static)
        ctx.fillStyle = accent;
        ctx.font = 'bold 24px "Inter", sans-serif';
        ctx.fillText('OFFICIAL MILESTONE UPDATE', contentX, contentY + 35);

        // 5. Checklist Items
        const items = [l1.value, l2.value, l3.value].filter(x => x);
        let itemY = 280;
        
        ctx.font = '600 42px "Inter", sans-serif';
        ctx.textBaseline = 'top';

        items.forEach((text, i) => {
            // Draw Checkbox Box
            ctx.fillStyle = 'rgba(255,255,255,0.05)';
            ctx.fillRect(100, itemY, w - 200, 90);
            
            // Draw Accent Border on Left of Box
            ctx.fillStyle = accent;
            ctx.fillRect(100, itemY, 6, 90);

            // Draw Check Icon
            ctx.beginPath();
            ctx.arc(160, itemY + 45, 20, 0, Math.PI*2);
            ctx.fillStyle = accent;
            ctx.fill();
            
            // Checkmark (White Tick)
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 4;
            ctx.lineCap = 'round';
            ctx.beginPath();
            ctx.moveTo(152, itemY + 45);
            ctx.lineTo(158, itemY + 52);
            ctx.lineTo(170, itemY + 38);
            ctx.stroke();

            // Draw Text
            ctx.fillStyle = '#fff';
            ctx.fillText(text, 210, itemY + 22);

            itemY += 120; // Spacing for next item
        });

        // 6. Footer Watermark
        ctx.fillStyle = 'rgba(255,255,255,0.15)';
        ctx.font = '500 20px "Inter", sans-serif';
        ctx.textAlign = 'right';
        ctx.fillText('generated via memeportal.tools', w - 40, h - 30);
    }

    // --- Event Listeners ---
    logoDrop.addEventListener('click', () => logoInput.click());
    
    logoInput.addEventListener('change', e => {
        const file = e.target.files[0];
        if(!file) return;
        const img = new Image();
        img.onload = () => {
            loadedLogo = img;
            logoDrop.classList.add('filled');
            logoDrop.querySelector('strong').textContent = file.name;
            draw();
        };
        img.src = URL.createObjectURL(file);
    });

    // Drag and Drop Visuals
    logoDrop.addEventListener('dragover', e => { e.preventDefault(); logoDrop.style.borderColor = 'var(--primary)'; });
    logoDrop.addEventListener('dragleave', e => { e.preventDefault(); logoDrop.style.borderColor = ''; });
    logoDrop.addEventListener('drop', e => {
        e.preventDefault();
        logoDrop.style.borderColor = '';
        if(e.dataTransfer.files[0]) {
            const file = e.dataTransfer.files[0];
            logoInput.files = e.dataTransfer.files; // assign to input
            // trigger manual change event if needed or just call handler
            const img = new Image();
            img.onload = () => {
                loadedLogo = img;
                logoDrop.classList.add('filled');
                logoDrop.querySelector('strong').textContent = file.name;
                draw();
            };
            img.src = URL.createObjectURL(file);
        }
    });

    // Live Update
    [titleIn, l1, l2, l3, colorIn, bgSelect].forEach(el => {
        el.addEventListener('input', draw);
    });

    // Download
    downloadBtn.addEventListener('click', () => {
        const a = document.createElement('a');
        a.download = 'dev-update.png';
        a.href = canvas.toDataURL('image/png');
        a.click();
    });

    // Initial Draw
    draw();
});
</script>
</body>
</html>
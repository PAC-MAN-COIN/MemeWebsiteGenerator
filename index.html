<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meme Coin Site Builder - V3.5</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        /* Builder Interface CSS (remains the same as V3.4) */
        /* ... (Paste the entire <style> block from V3.4 here) ... */
         * { box-sizing: border-box; }
        body {
            background: #0e0e0e; color: #fff; font-family: 'Poppins', sans-serif;
            margin: 0; padding: 2rem; display: flex; flex-direction: column;
            align-items: center; justify-content: start; min-height: 100vh;
        }
        h1 {
            font-size: 2.5rem; background: linear-gradient(90deg, #00ffe0, #ff00ff);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            font-family: 'Orbitron', sans-serif; margin-bottom: 2rem; text-align: center;
        }
        .form {
            width: 100%; max-width: 800px; display: flex; flex-direction: column; gap: 18px;
            margin-bottom: 20px;
        }
        input, textarea, select, button {
            padding: 14px; border-radius: 10px; border: 1px solid #333; font-size: 1rem;
            background: #1c1c1c; color: white; transition: border-color 0.2s; font-family: inherit;
        }
        input:focus, textarea:focus, select:focus { border-color: #00ffe0; outline: none; }
        textarea { resize: vertical; min-height: 100px; }
        .action-buttons button {
             background: linear-gradient(45deg, #00ffe0, #ff00ff); color: #000; font-weight: bold;
             cursor: pointer; transition: transform 0.2s; border: none; padding: 16px;
             margin: 10px 5px; flex-grow: 1; max-width: 300px;
        }
         .action-buttons button:hover { transform: scale(1.03); }
        .action-buttons {
             display: flex; justify-content: center; width: 100%; max-width: 800px;
             margin-bottom: 20px; flex-wrap: wrap;
        }
        iframe {
            margin-top: 20px; width: 100%; max-width: 1200px; height: 700px; border: 2px solid #333;
            border-radius: 12px; display: none; background-color: #111;
        }
        label { font-size: 0.95rem; margin-bottom: 6px; color: #aaa; display: block; }
        .form-group { display: flex; flex-direction: column; }
        .checkbox-group { background: #1c1c1c; padding: 15px; border-radius: 10px; border: 1px solid #333; margin-bottom: 10px; }
        .checkbox-group legend { color: #eee; margin-bottom: 10px; font-weight: bold; font-size: 1rem; padding: 0 5px; }
        /* Styling for Draggable Sections */
        #section-list .section-item {
            display: flex; align-items: center; gap: 10px; margin-bottom: 8px;
            padding: 8px; border: 1px dashed #444; border-radius: 5px;
            cursor: grab; user-select: none;
            transition: background-color 0.2s, border-color 0.2s;
        }
        #section-list .section-item:active { cursor: grabbing; }
        #section-list .section-item input[type="checkbox"] { width: 18px; height: 18px; accent-color: #00ffe0; cursor: pointer; flex-shrink: 0; }
        #section-list .section-item span { font-size: 0.9rem; color: #ccc; pointer-events: none; }
        /* Visual feedback for dragging */
        .dragging { opacity: 0.5; background-color: #2a2a2a; border-style: solid; }
        .drag-over { border-color: #00ffe0; background-color: #252525; }
        .drag-handle { font-size: 1.2rem; color: #777; margin-right: 5px; cursor: grab; }
        .drag-handle:active { cursor: grabbing; }

        input[type="file"] { padding: 10px; cursor: pointer; }
        input[type="file"]::-webkit-file-upload-button { background: #333; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin-right: 10px; }
        input[type="file"]:hover::-webkit-file-upload-button { background: #444; }
        hr { border: none; border-top: 1px solid #333; margin: 25px 0; }
        h2.form-section-title { font-size: 1.3rem; color: #00ffe0; margin-top: 20px; margin-bottom: 10px; font-family: 'Orbitron', sans-serif; border-bottom: 1px solid #333; padding-bottom: 8px; }
        .faq-item { display: flex; gap: 10px; margin-bottom: 10px; }
        .faq-item input { flex-grow: 1; }
        #addFaqButton { background: #333; color: #fff; font-weight: normal; font-size: 0.9rem; padding: 8px 12px; margin-top: 0; cursor: pointer; border-radius: 5px; }
        #addFaqButton:hover { background: #444; }
        .preview-note { font-size: 0.85rem; color: #888; text-align: center; margin-bottom: 15px; max-width: 600px;}
    </style>
</head>
<body>
    <h1>Meme Coin Site Builder üõ†Ô∏è V3.5</h1>

    <div class="form">
        <h2 class="form-section-title">General Setup</h2>
        <div class="form-group">
          <label for="coinName">Coin Name</label>
          <input id="coinName" placeholder="$COSMOPEPE" />
        </div>
         <div class="form-group">
            <label for="styleTheme">Overall Style Theme</label>
            <select id="styleTheme">
                <option value="default">Default (Neon Tech)</option>
                <option value="sci-fi">Sci-Fi (Sharp & Futuristic)</option>
                <option value="cartoony">Cartoony (Rounded & Bold)</option>
                <option value="minimalist">Minimalist (Clean & Simple)</option>
                <option value="retro-pixel">Retro Pixel (8-Bit Style)</option>
            </select>
         </div>
         <div class="form-group">
          <label for="colorTheme">Color Theme (Primary / Secondary)</label>
          <select id="colorTheme">
            <option value="#00ffe0,#ff00ff">Neon (Teal + Magenta)</option>
            <option value="#facc15,#ef4444">Gold + Red</option>
            <option value="#4ade80,#06b6d4">Green + Aqua</option>
            <option value="#9333ea,#f472b6">Purple + Pink</option>
            <option value="#38bdf8,#22c55e">Sky + Lime</option>
            <option value="#f97316,#e11d48">Orange + Rose</option>
            <option value="#ffffff,#aaaaaa">Monochrome (White + Gray)</option>
            <option value="#ff5733,#c70039">Fiery (Orange + Dark Red)</option>
            <option value="#FFD700,#FFA500">Gold & Orange</option>
            <option value="#00FF00,#FFFF00">Lime & Yellow (Pixel)</option>
          </select>
        </div>
         <div class="form-group">
            <label for="fontPair">Font Pairing (Heading / Body) - Theme might override</label>
            <select id="fontPair">
                <option value="Orbitron,Poppins">Orbitron / Poppins</option>
                <option value="Press Start 2P,VT323">Press Start 2P / VT323</option>
                <option value="Montserrat,Lato">Montserrat / Lato</option>
                <option value="Roboto Slab,Roboto">Roboto Slab / Roboto</option>
                <option value="Bangers,Permanent Marker">Bangers / Permanent Marker</option>
                <option value="Aldrich,Rajdhani">Aldrich / Rajdhani (Sci-Fi)</option>
                <option value="Inter,Inter">Inter / Inter (Minimalist)</option>
            </select>
         </div>

        <hr/>
        <h2 class="form-section-title">Core Content & Header</h2>
        <div class="form-group">
          <label for="tagline">Tagline</label>
          <input id="tagline" placeholder="The next intergalactic meme!" />
        </div>
        <div class="form-group">
          <label for="description">Main Description (Used in 'About' section)</label>
          <textarea id="description" placeholder="Explain your coin's unique story, mission, or meme power."></textarea>
        </div>
         <div class="form-group">
          <label for="ctaText">Header CTA Button Text (Optional)</label>
          <input id="ctaText" placeholder="e.g., Buy $COSMOPEPE Now!" />
        </div>
         <div class="form-group">
          <label for="ctaLink">Header CTA Button Link (Optional)</label>
          <input id="ctaLink" type="url" placeholder="Link to DEX/exchange" />
        </div>
        <div class="form-group">
          <label for="whitepaperLink">Whitepaper Link (Optional - Adds a button/link)</label>
          <input id="whitepaperLink" type="url" placeholder="Link to your whitepaper PDF/doc" />
        </div>


        <hr/>
        <h2 class="form-section-title">Website Structure & Elements</h2>
        <fieldset class="checkbox-group">
            <legend>Toggle Website Elements:</legend>

            <div><input type="checkbox" id="includeNavbar" checked><span>Top Navigation Bar</span></div>
            <div><input type="checkbox" id="showTagline" checked><span>Show Tagline in Header</span></div>
            <div><input type="checkbox" id="showLogo" checked><span>Show Logo Below Content</span></div>
            <div><input type="checkbox" id="showFooterLinks" checked><span>Show Social Links in Footer</span></div>
            <div><input type="checkbox" id="enableAnimations" checked><span>Enable Animations & Effects</span></div>
        </fieldset>

        <fieldset class="checkbox-group">
            <legend>Include & Reorder Content Sections (Drag & Drop):</legend>
            <div id="section-list">

                <div class="section-item" draggable="true" data-section-id="about">
                    <span class="drag-handle">‚ÜïÔ∏è</span>
                    <input type="checkbox" id="includeAboutCheck" checked>
                    <span>About Section</span>
                </div>
                <div class="section-item" draggable="true" data-section-id="how-to-buy">
                     <span class="drag-handle">‚ÜïÔ∏è</span>
                     <input type="checkbox" id="includeHowToBuyCheck" checked>
                     <span>How to Buy Section</span>
                 </div>
                <div class="section-item" draggable="true" data-section-id="tokenomics">
                     <span class="drag-handle">‚ÜïÔ∏è</span>
                     <input type="checkbox" id="includeTokenomicsCheck" checked>
                     <span>Tokenomics Section</span>
                 </div>
                <div class="section-item" draggable="true" data-section-id="roadmap">
                     <span class="drag-handle">‚ÜïÔ∏è</span>
                     <input type="checkbox" id="includeRoadmapCheck" checked>
                     <span>Roadmap Section</span>
                 </div>
                <div class="section-item" draggable="true" data-section-id="team">
                     <span class="drag-handle">‚ÜïÔ∏è</span>
                     <input type="checkbox" id="includeTeamCheck">
                     <span>Team Section (Optional)</span>
                 </div>
                <div class="section-item" draggable="true" data-section-id="partners">
                     <span class="drag-handle">‚ÜïÔ∏è</span>
                     <input type="checkbox" id="includePartnersCheck">
                     <span>Partners Section (Optional)</span>
                 </div>
                <div class="section-item" draggable="true" data-section-id="faq">
                     <span class="drag-handle">‚ÜïÔ∏è</span>
                     <input type="checkbox" id="includeFAQCheck">
                     <span>FAQ Section (Optional)</span>
                 </div>
                <div class="section-item" draggable="true" data-section-id="community">
                     <span class="drag-handle">‚ÜïÔ∏è</span>
                     <input type="checkbox" id="includeCommunityCheck" checked>
                     <span>Community/Socials Section</span>
                 </div>
            </div>
        </fieldset>

        <hr/>
        <h2 class="form-section-title">Section Content Details</h2>
        <div class="form-group">
          <label for="howToBuyContent">How to Buy Steps (1 step per line)</label>
          <textarea id="howToBuyContent" placeholder="1. Get a Wallet (e.g., MetaMask)\n2. Buy Base Coin (e.g., ETH/SOL)\n3. Swap on DEX (e.g., Uniswap/Raydium)\nContract: 0x123..."></textarea>
        </div>
        <div class="form-group">
          <label for="tokenomics">Tokenomics Details (1 item per line)</label>
          <textarea id="tokenomics" placeholder="Total Supply: 1 Trillion\nLiquidity: Burnt üî•\nTax: 0% Buy / 0% Sell\nOwnership: Renounced"></textarea>
        </div>
        <div class="form-group">
          <label for="roadmap">Roadmap Phases (1 item per line)</label>
          <textarea id="roadmap" placeholder="Phase 1: Launch & Memetic Spread\nPhase 2: Listings & Influencers\nPhase 3: Utility Sneak Peek\nPhase 4: ???"></textarea>
        </div>
         <div class="form-group">
          <label for="teamContent">Team Description (Optional, 1 member/role per line)</label>
          <textarea id="teamContent" placeholder="Lead Dev: Anon Chad\nMarketing Guru: Pepe Himself\nCommunity Mod: Based Wojak"></textarea>
        </div>
         <div class="form-group">
          <label for="partnersContent">Partners (Optional, 1 partner per line - Name or simple text)</label>
          <textarea id="partnersContent" placeholder="Partner DEX\nCool NFT Project\nBased Influencer"></textarea>
        </div>
         <div class="form-group">
            <label>FAQ Section Content (Optional)</label>
            <div id="faqList">
                <div class="faq-item">
                    <input type="text" placeholder="Question 1" class="faq-q">
                    <input type="text" placeholder="Answer 1" class="faq-a">
                </div>
            </div>
            <button type="button" id="addFaqButton" onclick="addFaqItem()">+ Add FAQ Item</button>
         </div>


        <hr/>
        <h2 class="form-section-title">Branding & Socials</h2>
         <div class="form-group">
          <label for="bannerImage">Upload Banner Image (Header Background)</label>
          <input type="file" id="bannerImage" accept="image/*" />
        </div>
        <div class="form-group">
          <label for="logoImage">Upload Logo Image</label>
          <input type="file" id="logoImage" accept="image/*" />
        </div>
        <div class="form-group">
          <label for="faviconImage">Upload Favicon (.png or .ico)</label>
          <input type="file" id="faviconImage" accept="image/x-icon,image/png,image/vnd.microsoft.icon" />
        </div>
        <div class="form-group">
          <label for="telegram">Telegram Link</label>
          <input id="telegram" type="url" placeholder="https://t.me/yourcoin" />
        </div>
        <div class="form-group">
          <label for="twitter">Twitter/X Link</label>
          <input id="twitter" type="url" placeholder="https://twitter.com/yourcoin" />
        </div>
         <div class="form-group">
          <label for="discord">Discord Link (Optional)</label>
          <input id="discord" type="url" placeholder="https://discord.gg/yourserver" />
        </div>
         <div class="form-group">
          <label for="otherLink">Other Link (e.g., Reddit, Medium - Optional)</label>
          <input id="otherLink" type="url" placeholder="https://..." />
        </div>
         <div class="form-group">
          <label for="footerText">Custom Footer Text (Optional, short)</label>
          <input id="footerText" placeholder="e.g., For entertainment purposes only." />
        </div>

        <hr/>

    </div> <div class="action-buttons">
        <button type="button" onclick="generatePreview()">Generate Preview</button>
        <button type="button" onclick="downloadSite()">Download Site File (HTML)</button>
    </div>

    <p class="preview-note">Note: Live preview might not work perfectly on all mobile devices due to browser limitations. Download the file for the most accurate view.</p>

    <iframe id="previewFrame" title="Website Preview"></iframe>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script>
        // --- Global Variables & Helpers ---
        let bannerData = '', logoData = '', faviconData = '';
        const getValue = (id, defaultValue = '') => document.getElementById(id)?.value.trim() ?? defaultValue;
        // *** ADD isChecked BACK ***
        const isChecked = (id) => document.getElementById(id)?.checked ?? false;

        // Base64 Image Upload
        function setupImageUpload(inputId, dataVariableSetter) { /* ... */
             const input = document.getElementById(inputId);
             input?.addEventListener('change', e => {
                 if (e.target.files && e.target.files[0]) {
                     toBase64(e.target.files[0], dataVariableSetter);
                 } else { dataVariableSetter(''); }
             });
        }
        setupImageUpload('bannerImage', d => bannerData = d);
        setupImageUpload('logoImage', d => logoData = d);
        setupImageUpload('faviconImage', d => faviconData = d);
        function toBase64(file, callback) { /* ... */
             const reader = new FileReader();
             reader.onload = () => callback(reader.result);
             reader.onerror = () => callback('');
             reader.readAsDataURL(file);
         }

        // Add FAQ Item
        function addFaqItem() { /* ... */
             const list = document.getElementById('faqList');
             const count = list.children.length + 1;
             const newItem = document.createElement('div');
             newItem.className = 'faq-item';
             newItem.innerHTML = `<input type="text" placeholder="Question ${count}" class="faq-q"><input type="text" placeholder="Answer ${count}" class="faq-a">`;
             list.appendChild(newItem);
        }

        // Font mapping and theme defaults
        const fontUrlMap = { /* ... */ };
        const themeDefaults = { /* ... */ };

        // Drag and Drop Logic (same as V3.4)
        const sectionListContainer = document.getElementById('section-list');
        let draggedItem = null;
        sectionListContainer.addEventListener('dragstart', (e) => { /* ... */
            const targetItem = e.target.closest('.section-item');
            if (!targetItem) return;
            draggedItem = targetItem;
            setTimeout(() => { if(draggedItem) draggedItem.classList.add('dragging'); }, 0);
        });
        sectionListContainer.addEventListener('dragend', (e) => { /* ... */
             if (draggedItem) { draggedItem.classList.remove('dragging'); draggedItem = null; }
        });
        sectionListContainer.addEventListener('dragover', (e) => { /* ... */
            e.preventDefault();
            const targetItem = e.target.closest('.section-item');
            const container = sectionListContainer;
            if (targetItem && draggedItem && targetItem !== draggedItem) {
                 const targetRect = targetItem.getBoundingClientRect();
                 const isAfter = e.clientY > targetRect.top + targetRect.height / 2;
                 if (isAfter) { container.insertBefore(draggedItem, targetItem.nextSibling); }
                 else { container.insertBefore(draggedItem, targetItem); }
            }
        });
         sectionListContainer.addEventListener('dragenter', (e) => { /* ... */
             const targetItem = e.target.closest('.section-item');
             if (targetItem && targetItem !== draggedItem) { targetItem.classList.add('drag-over'); }
         });
         sectionListContainer.addEventListener('dragleave', (e) => { /* ... */
              const targetItem = e.target.closest('.section-item');
              if (targetItem) { targetItem.classList.remove('drag-over'); }
          });
         sectionListContainer.addEventListener('drop', (e) => { /* ... */
             e.preventDefault();
             const targetItem = e.target.closest('.section-item');
              if (targetItem) { targetItem.classList.remove('drag-over'); }
         });


        // --- Main HTML Builder Function ---
        function buildHTML() {
            // Get General Input Data
            const name = getValue('coinName', 'Meme Coin');
            const tagline = getValue('tagline', 'To the Moon!');
            const styleTheme = getValue('styleTheme', 'default');
            const colors = getValue('colorTheme', '#00ffe0,#ff00ff').split(',');
            const selectedFontPair = getValue('fontPair', '').split(',');
            const footerText = getValue('footerText');
            const whitepaperLink = getValue('whitepaperLink');
            // *** USE isChecked for these toggles ***
            const enableAnimations = isChecked('enableAnimations');
            const showTagline = isChecked('showTagline');
            const showLogo = isChecked('showLogo');
            const showFooterLinks = isChecked('showFooterLinks');
            const includeNavbar = isChecked('includeNavbar');
            const ctaText = getValue('ctaText'); const ctaLink = getValue('ctaLink');
            const telegram = getValue('telegram'); const twitter = getValue('twitter');
            const discord = getValue('discord'); const otherLink = getValue('otherLink');

             // Get Section Content
             const description = getValue('description');
             const howToBuyRaw = getValue('howToBuyContent');
             const tokenomicsRaw = getValue('tokenomics');
             const roadmapRaw = getValue('roadmap');
             const teamRaw = getValue('teamContent');
             const partnersRaw = getValue('partnersContent');
             const faqItems = [];
             document.querySelectorAll('#faqList .faq-item').forEach(item => { /* ... */ });

            // --- Process Data ---
            // Fonts
            let headingFont = themeDefaults[styleTheme]?.heading || 'Orbitron';
            let bodyFont = themeDefaults[styleTheme]?.body || 'Poppins';
            if (selectedFontPair.length === 2 && selectedFontPair[0] && selectedFontPair[1]) { /* ... */ }
            const googleFontParams = [fontUrlMap[headingFont], fontUrlMap[bodyFont]].filter(Boolean).join('&family=');
            const googleFontLink = googleFontParams ? `<link href="https://fonts.googleapis.com/css2?family=${googleFontParams}&display=swap" rel="stylesheet">` : '';

            // Images (Base64)
            const faviconHref = faviconData || logoData || 'favicon.ico';

            // Process Lists
            const processList = (raw) => raw ? raw.split("\n").map(item => `<li>${item.trim()}</li>`).join('') : '';
            const howToBuyList = processList(howToBuyRaw); const tokenomicsList = processList(tokenomicsRaw);
            const roadmapList = processList(roadmapRaw); const teamList = processList(teamRaw);
            const partnersList = processList(partnersRaw);
            const faqListHTML = faqItems.map(item => `<details><summary>${item.q}</summary><p>${item.a}</p></details>`).join('');

            // --- Build HTML Sections based on DOM Order ---
            const sections = []; // For navbar order
            let contentSectionsHTML = '';
            const sectionItems = document.querySelectorAll('#section-list .section-item');

            sectionItems.forEach(item => {
                const sectionId = item.dataset.sectionId;
                const checkbox = item.querySelector('input[type="checkbox"]');
                // *** USE checkbox variable here ***
                const isIncluded = checkbox ? checkbox.checked : false;

                if (!isIncluded) return;

                let sectionTitle = ''; let content = ''; let icon = '';
                switch(sectionId) { /* ... (same switch logic, ensure content variables are used) ... */
                     case 'about': if (!description) return; content = `<p>${description.replace(/\n/g, '<br>')}</p>`; icon = '‚ÑπÔ∏è'; sectionTitle = 'About'; break;
                     case 'how-to-buy': if (!howToBuyList) return; content = `<ol>${howToBuyList.replace(/<li>/g, '<li class="step">')}</ol>`; icon = 'üõí'; sectionTitle = 'How to Buy'; break;
                     case 'tokenomics': if (!tokenomicsList) return; content = `<ul>${tokenomicsList}</ul>`; icon = 'üìä'; sectionTitle = 'Tokenomics'; break;
                     case 'roadmap': if (!roadmapList) return; content = `<ul>${roadmapList}</ul>`; icon = 'üó∫Ô∏è'; sectionTitle = 'Roadmap'; break;
                     case 'team': if (!teamList) return; content = `<ul class="team-list">${teamList}</ul>`; icon = 'üßë‚Äçü§ù‚Äçüßë'; sectionTitle = 'Team'; break;
                     case 'partners': if (!partnersList) return; content = `<ul class="partners-list">${partnersList}</ul>`; icon = 'ü§ù'; sectionTitle = 'Partners'; break;
                     case 'faq': if (!faqListHTML) return; content = `<div class="faq-container">${faqListHTML}</div>`; icon = '‚ùì'; sectionTitle = 'FAQ'; break;
                     case 'community': const socialLinksArr = [ /* ... */ ].filter(item => item.link); if (socialLinksArr.length === 0) return; content = `<div class="social-links">${socialLinksArr.map(sl => `<a href="${sl.link}" target="_blank" class="social-button"><span class="social-icon">${sl.icon}</span> ${sl.text}</a>`).join('')}</div>`; icon = 'üåê'; sectionTitle = 'Community'; break;
                 }
                 if (sectionTitle) {
                     sections.push({ id: sectionId, title: sectionTitle });
                     contentSectionsHTML += `<section id="${sectionId}"><h3><span class="section-icon">${icon}</span> ${sectionTitle}</h3>${content}</section>\n`;
                 }
            });


            // Navbar HTML
             const navbarHTML = includeNavbar ? `
             <nav class="navbar">
                 <div class="nav-container">
                 <a href="#" class="nav-brand">${name}</a>
                 <ul class="nav-links">
                     ${sections.map(s => `<li><a href="#${s.id}">${s.title}</a></li>`).join('')}
                     ${whitepaperLink ? `<li><a href="${whitepaperLink}" target="_blank" class="nav-button">Whitepaper</a></li>` : ''}
                 </ul>
                 </div>
             </nav>` : '';

            // Header HTML
            const headerSection = `
             <header>
                 ${bannerData ? `<img src="${bannerData}" class="banner" alt="Banner" loading="lazy" />` : ''}
                 <h1>${name}</h1>
                 ${showTagline ? `<h2>${tagline}</h2>` : ''}
                 <div class="header-buttons">
                 ${ctaText && ctaLink ? `<a href="${ctaLink}" target="_blank" class="cta-button primary-cta">${ctaText}</a>` : ''}
                 ${whitepaperLink && !includeNavbar ? `<a href="${whitepaperLink}" target="_blank" class="cta-button secondary-cta">Whitepaper</a>` : ''}
                 </div>
             </header>`;

            // Logo HTML
            const logoHTML = showLogo && logoData ? `<div class="logo-container"><img src="${logoData}" class="logo" alt="${name} Logo" loading="lazy" /></div>` : '';

            // Footer HTML
             const footerSocialLinks = [ { link: telegram, text: 'Telegram'}, /* ... */ ].filter(item => item.link);
             const footerSection = `<footer><p>¬© ${new Date().getFullYear()} ${name}. All Rights Reserved.</p>${footerText ? `<p class="footer-disclaimer">${footerText}</p>` : ''}${showFooterLinks && footerSocialLinks.length > 0 ? `<p class="footer-links">${footerSocialLinks.map(sl => `<a href="${sl.link}" target="_blank">${sl.text}</a>`).join(' | ')}</p>` : ''}</footer>`;

            // --- Assemble Full HTML Document ---
            return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="${tagline} - Join the ${name} meme coin!">
    <meta name="keywords" content="${name}, meme coin, crypto, token, ${tagline.split(' ').join(', ')}">
    <title>${name} - ${tagline || 'Meme Coin'}</title>
    ${googleFontLink}
    <link rel="icon" href="${faviconHref}">

    <style>
        /* --- PASTE THE FULL CSS FROM V3.3 HERE --- */
        /* Base Styles, Elements, Layout, Navbar, Header, Sections, Footer, Animations, Responsive, THEMES */
         /* --- Base Styles & Variables --- */
        :root {
          --font-heading: '${headingFont}', sans-serif; --font-body: '${bodyFont}', sans-serif;
          --color-primary: ${colors[0]}; --color-secondary: ${colors[1]};
          --color-primary-transparent: ${colors[0]}20; --color-secondary-transparent: ${colors[1]}20;
          --color-primary-shadow: ${colors[0]}80; --color-secondary-shadow: ${colors[1]}80;
          --background-color: #0a0a0a; --text-color: #fff; --text-color-muted: #ccc;
          --card-background: rgba(18, 18, 18, 0.85); --card-border: #222;
          --border-radius-small: 5px; --border-radius-medium: 10px; --border-radius-large: 15px;
          --shadow-color: rgba(0, 0, 0, 0.6); --shadow-light: 0 4px 15px var(--shadow-color);
          --shadow-medium: 0 8px 30px var(--shadow-color);
          --header-overlay: linear-gradient(rgba(10, 10, 10, 0.7), rgba(10, 10, 10, 0.9));
        }
        * { margin: 0; padding: 0; box-sizing: border-box; scroll-behavior: smooth; }
        /* Mobile Scroll Fix */
        body {
          font-family: var(--font-body); background-color: var(--background-color); color: var(--text-color);
          line-height: 1.7; overflow-x: hidden; position: relative;
          -webkit-overflow-scrolling: touch; overflow-y: scroll;
        }
        html, body { height: 100%; } /* Maybe helps scroll context */

        /* Animation Control & Logo Fix */
        body.animations-disabled * { animation: none !important; transition: none !important; }
        .logo { width: clamp(100px, 20vw, 150px); border-radius: 50%; border: 4px solid var(--color-primary); box-shadow: 0 0 25px var(--color-primary-shadow); transition: all 0.5s ease; display: inline-block; }
        body:not(.animations-disabled) .theme-default .logo, body:not(.animations-disabled) .theme-cartoony .logo { animation: spinGlow 8s linear infinite alternate; }
        body.theme-sci-fi .logo, body.theme-minimalist .logo, body.theme-retro-pixel .logo { animation: none; }
        .logo:hover { transform: scale(1.1); box-shadow: 0 0 40px var(--color-secondary-shadow); }

        /* Basic Elements */
        h1, h2, h3 { font-family: var(--font-heading); line-height: 1.3; }
        h1 { font-size: clamp(2.5rem, 10vw, 5.5rem); font-weight: 900; }
        h2 { font-size: clamp(1.2rem, 5vw, 2rem); font-weight: 400; color: var(--text-color-muted); margin-bottom: 1.5rem; }
        h3 { font-size: clamp(1.8rem, 6vw, 2.8rem); color: var(--color-primary); margin-bottom: 2rem; position: relative; padding-bottom: 0.5rem; border-bottom: 2px solid var(--color-primary-transparent); display: inline-block; }
        h3 .section-icon { margin-right: 10px; display: inline-block; }
        p { margin-bottom: 1rem; color: var(--text-color-muted); }
        a { color: var(--color-secondary); text-decoration: none; transition: color 0.3s ease; }
        a:hover { color: var(--color-primary); }
        ul, ol { list-style: none; padding-left: 0; }
        section ul li, section ol li { position: relative; padding: 0.8rem 0 0.8rem 35px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); margin-bottom: 0.5rem; }
        section ul li:last-child, section ol li:last-child { border-bottom: none; }
        section ul li::before, section ol li::before { content: '¬ª'; position: absolute; left: 5px; top: 50%; transform: translateY(-50%); font-size: 1.4rem; color: var(--color-primary); font-weight: bold; }
        ol { counter-reset: step-counter; }
        ol li.step { padding-left: 45px; }
        ol li.step::before { content: counter(step-counter); counter-increment: step-counter; left: 5px; width: 25px; height: 25px; line-height: 25px; text-align: center; border-radius: 50%; background: var(--color-primary); color: #000; font-size: 0.9rem; font-weight: bold; }

        /* Layout & Structure */
        .content { max-width: 1100px; margin: -50px auto 0 auto; padding: 3rem 1.5rem; position: relative; z-index: 3; display: flex; flex-direction: column; gap: 4rem; }
        section { padding: 3rem clamp(1rem, 5vw, 3rem); background: var(--card-background); border-radius: var(--border-radius-large); box-shadow: var(--shadow-medium); border: 1px solid var(--card-border); backdrop-filter: blur(5px); position: relative; overflow: hidden; }

        /* Navbar */
        .navbar { background: rgba(10, 10, 10, 0.8); backdrop-filter: blur(10px); padding: 1rem 2rem; position: fixed; top: 0; left: 0; width: 100%; z-index: 100; border-bottom: 1px solid var(--card-border); box-shadow: var(--shadow-light); }
        .navbar .nav-container { display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto; }
        .navbar .nav-brand { font-family: var(--font-heading); font-size: 1.5rem; color: var(--color-primary); font-weight: bold; }
        .navbar .nav-links { display: flex; gap: 1.5rem; align-items: center; list-style: none; }
        .navbar .nav-links a { color: var(--text-color-muted); font-weight: 500; }
        .navbar .nav-links a:hover { color: var(--color-primary); }
        .navbar .nav-button { background: var(--color-secondary); color: #000; padding: 0.5rem 1rem; border-radius: var(--border-radius-small); font-weight: bold; transition: transform 0.2s ease, background 0.3s ease; }
        .navbar .nav-button:hover { background: var(--color-primary); transform: scale(1.05); }
        body.nav-active { padding-top: 70px; }

        /* Header */
        header { position: relative; min-height: 70vh; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 5rem 2rem; overflow: hidden; background: var(--header-overlay); }
        body.nav-active header { margin-top: -70px; }
        header img.banner { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: -1; filter: brightness(0.6); opacity: 0.8; }
        header h1 { color: var(--color-primary); text-shadow: 0 0 20px var(--color-primary-shadow), 0 0 35px var(--color-secondary-shadow); margin: 1rem 0; z-index: 2; animation: glow 2.5s ease-in-out infinite alternate; }
        header h2 { text-shadow: 1px 1px 10px rgba(0,0,0,0.7); z-index: 2; max-width: 800px; animation: fadeInUp 1s ease-out forwards; }
        .header-buttons { margin-top: 1.5rem; display: flex; gap: 1rem; flex-wrap: wrap; justify-content: center; z-index: 2; }
        .cta-button { font-family: var(--font-heading); color: #000; padding: 15px 35px; border-radius: 50px; text-decoration: none; font-size: clamp(1rem, 4vw, 1.3rem); font-weight: 600; transition: transform 0.3s ease, box-shadow 0.3s ease; display: inline-block; }
        .cta-button.primary-cta { background: linear-gradient(45deg, var(--color-primary), var(--color-secondary)); box-shadow: 0 5px 25px var(--color-primary-shadow); }
        .cta-button.secondary-cta { background: var(--text-color-muted); color: #000; box-shadow: 0 3px 15px rgba(0,0,0,0.4); }
        .cta-button:hover { transform: scale(1.08); }
        .cta-button.primary-cta:hover { box-shadow: 0 8px 35px var(--color-secondary-shadow); }
        .cta-button.secondary-cta:hover { background: var(--text-color); }

        /* Specific Sections Styling */
        #how-to-buy {}
        #tokenomics ul li::before { content: 'üìä'; }
        #roadmap ul li::before { content: 'üöÄ'; }
        #team .team-list li::before { content: 'üë§'; }
        #partners .partners-list li::before { content: 'ü§ù'; }
        #faq .faq-container { display: flex; flex-direction: column; gap: 1rem; }
        #faq details { background: rgba(255,255,255,0.05); border-radius: var(--border-radius-medium); border: 1px solid rgba(255,255,255,0.1); }
        #faq summary { padding: 1rem; cursor: pointer; font-weight: bold; color: var(--color-primary); list-style-type: '‚ùì '; }
        #faq details[open] summary { list-style-type: '‚ùï '; }
        #faq details p { padding: 0 1rem 1rem 1rem; border-top: 1px solid rgba(255,255,255,0.1); margin-top: 0.5rem; }
        #community { text-align: center; }
        #community .social-links { display: flex; justify-content: center; gap: 1.5rem; flex-wrap: wrap; margin-top: 1.5rem; }
        .social-button { color: #0a0a0a; font-weight: 600; text-decoration: none; padding: 0.8rem 1.8rem; background: linear-gradient(45deg, var(--color-primary), var(--color-secondary)); border-radius: 50px; transition: all 0.3s ease; box-shadow: 0 0 15px var(--color-primary-shadow); font-family: var(--font-heading); font-size: clamp(0.9rem, 3vw, 1.1rem); text-transform: uppercase; border: 2px solid transparent; display: inline-flex; align-items: center; gap: 8px; }
        .social-button:hover { transform: translateY(-5px) scale(1.05); box-shadow: 0 5px 25px var(--color-secondary-shadow); background: linear-gradient(45deg, var(--color-secondary), var(--color-primary)); }
        .social-icon { display: inline-block; }

        /* Logo Container */
        .logo-container { text-align: center; padding: 2rem 0; margin-top: 2rem; }

        /* Footer */
        footer { background: #050505; padding: 2.5rem 1rem; text-align: center; border-top: 3px solid var(--color-primary); margin-top: 4rem; }
        footer p { font-size: clamp(0.9rem, 2.5vw, 1rem); color: #aaa; margin-bottom: 0.8rem; }
        footer p.footer-disclaimer { font-size: 0.85rem; color: #777; font-style: italic; }
        footer .footer-links a { margin: 0 8px; }

        /* Base Animations */
        @keyframes glow { from { text-shadow: 0 0 15px var(--color-primary-shadow), 0 0 25px var(--color-secondary-shadow); } to { text-shadow: 0 0 25px var(--color-primary-shadow), 0 0 40px var(--color-secondary-shadow); } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(25px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes spinGlow { 0% { transform: rotate(0deg); box-shadow: 0 0 25px var(--color-primary-shadow); border-color: var(--color-primary); } 50% { transform: rotate(180deg); box-shadow: 0 0 35px var(--color-secondary-shadow); border-color: var(--color-secondary); } 100% { transform: rotate(360deg); box-shadow: 0 0 25px var(--color-primary-shadow); border-color: var(--color-primary); } }

        /* Responsiveness */
        @media (max-width: 768px) { body.nav-active { padding-top: 60px; } .navbar { padding: 0.8rem 1rem; } .navbar .nav-container { flex-wrap: wrap; } .navbar .nav-links { display: none; width: 100%; flex-direction: column; align-items: flex-start; padding-top: 1rem; background: rgba(10, 10, 10, 0.95); } /* Needs JS for mobile toggle */ header { min-height: 60vh; padding: 4rem 1rem; } body.nav-active header { margin-top: -60px; } .content { margin-top: -30px; padding: 2rem 1rem; gap: 2.5rem; } section { padding: 2rem; } h1 { font-size: 2.5rem; } h2 { font-size: 1.3rem; } h3 { font-size: 1.8rem; } .cta-button { padding: 12px 30px; font-size: 1.1rem; } .social-button { padding: 0.7rem 1.5rem; font-size: 0.9rem;} }
        @media (max-width: 480px) { h1 { font-size: 2.2rem; } h2 { font-size: 1.1rem; } h3 { font-size: 1.6rem; } .cta-button { padding: 10px 25px; font-size: 1rem; } .social-button { padding: 0.6rem 1.2rem; font-size: 0.8rem; } }

        /* Style Theme Overrides */
        /* Sci-Fi Theme */ .theme-sci-fi { --border-radius-small: 2px; --border-radius-medium: 4px; --border-radius-large: 6px; --card-background: rgba(10, 20, 30, 0.8); --card-border: var(--color-primary-transparent); --header-overlay: linear-gradient(rgba(5, 10, 20, 0.8), rgba(5, 15, 25, 0.95)); } .theme-sci-fi h1, .theme-sci-fi h2, .theme-sci-fi h3 { text-transform: uppercase; letter-spacing: 1px; } .theme-sci-fi section { border-left: 3px solid var(--color-primary); border-right: 3px solid var(--color-secondary); } .theme-sci-fi .cta-button, .theme-sci-fi .social-button, .theme-sci-fi .navbar .nav-button { border-radius: var(--border-radius-small); } .theme-sci-fi .logo { border-radius: 10%; border-width: 2px; animation: none; } .theme-sci-fi section ul li::before, .theme-sci-fi section ol li::before { content: '>'; font-weight: bold; font-size: 1.5rem; } .theme-sci-fi ol li.step::before { border-radius: 2px; } .theme-sci-fi #faq details { border: 1px solid var(--color-primary-transparent); } .theme-sci-fi #faq summary { list-style-type: '+ '; } .theme-sci-fi #faq details[open] summary { list-style-type: '- '; }
        /* Cartoony Theme */ .theme-cartoony { --border-radius-small: 15px; --border-radius-medium: 25px; --border-radius-large: 35px; --card-background: rgba(25, 25, 25, 0.9); --card-border: transparent; --shadow-color: rgba(0, 0, 0, 0.4); --shadow-medium: 5px 5px 0px var(--color-primary), 10px 10px 0px var(--color-secondary); } .theme-cartoony body { background: linear-gradient(45deg, #111, #222); } .theme-cartoony h1, .theme-cartoony h2, .theme-cartoony h3 { text-shadow: 3px 3px 0px #000; } .theme-cartoony section { box-shadow: var(--shadow-medium); border: 3px solid #000; } .theme-cartoony .cta-button, .theme-cartoony .social-button, .theme-cartoony .navbar .nav-button { border-radius: 50px; border: 2px solid #000; box-shadow: 3px 3px 0px #000; transform: scale(1); } .theme-cartoony .cta-button:hover, .theme-cartoony .social-button:hover, .theme-cartoony .navbar .nav-button:hover { transform: translate(-2px, -2px); box-shadow: 5px 5px 0px #000; } .theme-cartoony .logo { border-radius: 50%; border-width: 5px; border-style: dashed; } .theme-cartoony section ul li::before, .theme-cartoony section ol li::before { content: '‚≠ê'; font-size: 1.6rem; } .theme-cartoony ol li.step::before { border-radius: 50%; border: 2px solid #000; } .theme-cartoony #faq details { border: 2px solid #000; box-shadow: 2px 2px 0 #000; } .theme-cartoony #faq summary { list-style-type: 'üëâ '; } .theme-cartoony #faq details[open] summary { list-style-type: 'üëá '; }
        /* Minimalist Theme */ .theme-minimalist { --border-radius-small: 4px; --border-radius-medium: 8px; --border-radius-large: 12px; --background-color: #f8f9fa; --text-color: #212529; --text-color-muted: #6c757d; --card-background: #ffffff; --card-border: #dee2e6; --shadow-light: 0 2px 5px rgba(0, 0, 0, 0.1); --shadow-medium: 0 4px 10px rgba(0, 0, 0, 0.1); --header-overlay: linear-gradient(rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.3)); } .theme-minimalist body.nav-active { padding-top: 60px; } .theme-minimalist .navbar { background: rgba(255, 255, 255, 0.9); border-bottom-color: #e9ecef; } .theme-minimalist .navbar a { color: #495057; } .theme-minimalist .navbar .nav-brand { color: var(--color-primary); } .theme-minimalist .navbar .nav-links a:hover { color: var(--color-primary); } .theme-minimalist .navbar .nav-button { background: var(--color-primary); color: var(--text-color); } .theme-minimalist .navbar .nav-button:hover { background: var(--color-secondary); } .theme-minimalist header img.banner { opacity: 0.5; filter: grayscale(50%) brightness(1.2); } .theme-minimalist header h1 { color: var(--color-primary); text-shadow: none; animation: none; } .theme-minimalist header h2 { color: var(--text-color-muted); text-shadow: none; animation: none; } .theme-minimalist section { box-shadow: var(--shadow-medium); border: 1px solid var(--card-border); } .theme-minimalist h3 { color: #343a40; border-bottom-color: #dee2e6; } .theme-minimalist .cta-button, .theme-minimalist .social-button { border-radius: var(--border-radius-medium); box-shadow: var(--shadow-light); animation: none; } .theme-minimalist .cta-button.primary-cta { background: var(--color-primary); color: #fff; } .theme-minimalist .cta-button.secondary-cta { background: #e9ecef; color: #495057; } .theme-minimalist .cta-button:hover { transform: translateY(-2px); } .theme-minimalist .social-button { background: #f1f3f5; color: #495057; box-shadow: none; border: 1px solid #dee2e6; } .theme-minimalist .social-button:hover { background: #e9ecef; } .theme-minimalist .logo { border-radius: var(--border-radius-medium); border: 2px solid var(--card-border); box-shadow: none; animation: none; } .theme-minimalist footer { background: #e9ecef; color: #6c757d; border-top-color: var(--color-primary); } .theme-minimalist footer a { color: var(--color-primary); } .theme-minimalist footer a:hover { color: var(--color-secondary); } .theme-minimalist section ul li::before, .theme-minimalist section ol li::before { content: '‚Ä¢'; color: var(--color-primary); } .theme-minimalist ol li.step::before { background: #e9ecef; color: #495057; } .theme-minimalist #faq details { background: #f8f9fa; border-color: #dee2e6; } .theme-minimalist #faq summary { color: var(--color-primary); list-style-type: '‚Ä∫ '; } .theme-minimalist #faq details[open] summary { list-style-type: 'Àá '; }
        /* Retro Pixel Theme */ .theme-retro-pixel { --border-radius-small: 0; --border-radius-medium: 0; --border-radius-large: 0; --card-background: rgba(30, 30, 30, 0.9); --card-border: var(--color-primary); --background-color: #000; image-rendering: pixelated; } .theme-retro-pixel body { background: #000 url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="4" height="4" viewBox="0 0 4 4"><path fill="%23222" d="M0 0h2v2H0zM2 2h2v2H2z"/></svg>'); } .theme-retro-pixel h1, .theme-retro-pixel h2, .theme-retro-pixel h3 { text-shadow: 2px 2px 0 var(--color-secondary); letter-spacing: 1px; } .theme-retro-pixel section { border: 2px solid var(--color-primary); box-shadow: 4px 4px 0px var(--color-secondary); } .theme-retro-pixel .navbar { background: rgba(0,0,0,0.9); border-bottom: 2px solid var(--color-primary); } .theme-retro-pixel .navbar .nav-button { background: var(--color-primary); color: #000; border: 1px solid var(--color-secondary); } .theme-retro-pixel header img.banner { filter: contrast(1.5) brightness(0.8); } .theme-retro-pixel .cta-button, .theme-retro-pixel .social-button { border: 2px solid var(--color-primary); box-shadow: 3px 3px 0px var(--color-secondary); transform: scale(1); } .theme-retro-pixel .cta-button:hover, .theme-retro-pixel .social-button:hover { transform: translate(-2px, -2px); box-shadow: 5px 5px 0px var(--color-secondary); } .theme-retro-pixel .logo { border: 3px solid var(--color-primary); animation: none; image-rendering: pixelated; } .theme-retro-pixel section ul li::before, .theme-retro-pixel section ol li::before { content: '#'; color: var(--color-primary); } .theme-retro-pixel ol li.step::before { background: var(--color-primary); color: #000; } .theme-retro-pixel #faq details { border: 1px solid var(--color-primary); } .theme-retro-pixel #faq summary { list-style-type: '[+] '; } .theme-retro-pixel #faq details[open] summary { list-style-type: '[-] '; }

    </style>
</head>
<body class="theme-${styleTheme} ${enableAnimations ? '' : 'animations-disabled'} ${includeNavbar ? 'nav-active' : ''}">

    ${navbarHTML}
    ${headerSection}

    <div class="content">
        ${contentSectionsHTML}
    </div>

    ${logoHTML}
    ${footerSection}

</body>
</html>`;
        } // End of buildHTML function


        // --- Event Listeners & Utils ---
        function generatePreview() { // Uses srcdoc and setTimeout
             const preview = document.getElementById("previewFrame");
             preview.style.display = 'block';
             preview.srcdoc = '<!DOCTYPE html><html><head><style>body{background:#111; color:#555; display:flex; justify-content:center; align-items:center; height:100vh; font-family: sans-serif;}p{border:1px solid #333; padding: 20px; border-radius: 5px;}</style></head><body><p>Generating Preview...</p></body></html>';

             setTimeout(() => {
                 try {
                     const html = buildHTML();
                     preview.srcdoc = html;
                 } catch (error) {
                     console.error("Error generating preview:", error);
                     preview.srcdoc = '<!DOCTYPE html><html><head><style>body{background:darkred; color:white; display:flex; justify-content:center; align-items:center; height:100vh; font-family: sans-serif;}p{border:1px solid #eee; padding: 20px; border-radius: 5px;}</style></head><body><p>Error generating preview. Check console.</p></body></html>';
                 }
             }, 0);
        }

        // Download function (Single HTML with Base64)
        function downloadSite() {
             try {
                 const html = buildHTML();
                 const name = getValue('coinName').replace(/[^a-zA-Z0-9]/g, '') || 'memecoin';
                 const blob = new Blob([html], { type: "text/html" });
                 saveAs(blob, `${name}-website.html`);
             } catch (error) { console.error("Download Error:", error); alert("Download Prep Error. Check console."); }
        }

    </script>
</body>
</html>
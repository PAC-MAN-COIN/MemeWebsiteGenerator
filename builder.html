<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meme Portal - Website Builder</title>
    <link rel="icon" href="images/logo.png">
    <link rel="stylesheet" href="style.css">
    <style>
        main#builder-main { padding-top: 1rem; }
        h1.builder-title { font-size: 2.5rem; background: linear-gradient(90deg, #00ffe0, #ff00ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-family: 'Orbitron', sans-serif; margin-bottom: 1rem; /* Reduced margin */ text-align: center; margin-top: 1rem; }
        #current-profile-indicator { text-align: center; color: #8899a6; font-size: 0.9rem; margin-bottom: 1.5rem; font-style: italic; }
        #profile-required-message { text-align: center; color: #facc15; font-weight: bold; background-color: #333; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; display: none; /* Hidden by default */ }

        .form { width: 100%; max-width: 800px; display: flex; flex-direction: column; gap: 18px; margin-bottom: 20px; }
        input, textarea, select, button { padding: 14px; border-radius: 10px; border: 1px solid #333; font-size: 1rem; background: #1c1c1c; color: white; transition: border-color 0.2s; font-family: inherit; width: 100%; box-sizing: border-box; }
        input:disabled, textarea:disabled, select:disabled { background-color: #2a2a2a; cursor: not-allowed; opacity: 0.7; }
        input:focus, textarea:focus, select:focus { border-color: #00ffe0; outline: none; }
        textarea { resize: vertical; min-height: 100px; }
        .action-buttons { display: flex; justify-content: center; width: 100%; max-width: 800px; margin-bottom: 20px; flex-wrap: wrap; gap: 10px; }
        .action-buttons button { background: linear-gradient(45deg, #00ffe0, #ff00ff); color: #000; font-weight: bold; cursor: pointer; transition: all 0.2s; border: none; padding: 16px; margin: 0; flex-grow: 1; max-width: 300px; width: auto; border-radius: 10px; } /* Added radius */
        .action-buttons button:hover { transform: scale(1.03); }
        .action-buttons button:disabled { background: #555; color: #999; cursor: not-allowed; transform: none; box-shadow: none; }
        #saveSettingsBtn { background: #38bdf8; color: #000; max-width: none; flex-basis: 100%; /* Make save button full width */ order: -1; /* Move save button first */} /* Style save button differently */
        #saveSettingsBtn.saved { background: #4ade80; } /* Green when saved */

        iframe { margin-top: 20px; width: 100%; max-width: 1200px; height: 700px; border: 2px solid #333; border-radius: 12px; display: none; background-color: #111; }
        label { font-size: 0.95rem; margin-bottom: 6px; color: #aaa; display: block; }
        .form-group { display: flex; flex-direction: column; }
        .checkbox-group { background: #1c1c1c; padding: 15px; border-radius: 10px; border: 1px solid #333; margin-bottom: 10px; }
        .checkbox-group legend { color: #eee; margin-bottom: 10px; font-weight: bold; font-size: 1rem; padding: 0 5px; border-bottom: 1px solid #444; display: inline-block; }
        .checkbox-group div:not(.section-item) { display: flex; align-items: center; margin-bottom: 8px; }
        .checkbox-group div:not(.section-item) input[type="checkbox"] { width: auto; margin-right: 10px; flex-shrink: 0; accent-color: #00ffe0; height: 18px; }
        .checkbox-group div:not(.section-item) label { margin-bottom: 0; color: #ccc; font-size: 0.95rem; }
        #section-list { display: block; padding: 10px 0; list-style: none; }
        #section-list .section-item { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; padding: 10px 12px; border: 1px dashed #444; border-radius: 5px; cursor: grab; user-select: none; transition: background-color 0.2s, border-color 0.2s; background: #2a2a2a; width: 100%; box-sizing: border-box; }
        #section-list .section-item:last-child { margin-bottom: 0; }
        #section-list .section-item:active { cursor: grabbing; }
        #section-list .section-item input[type="checkbox"] { width: 18px; height: 18px; cursor: pointer; flex-shrink: 0; margin: 0; accent-color: #00ffe0; }
        #section-list .section-item span { font-size: 0.9rem; color: #ccc; pointer-events: none; flex-grow: 0; text-align: left; line-height: 1.3; }
        .drag-handle { font-size: 1.2rem; color: #777; margin-right: 5px; cursor: grab; flex-shrink: 0; line-height: 1; }
        .drag-handle:active { cursor: grabbing; }
        .dragging { opacity: 0.5; background-color: #3a3a3a; border-style: solid; }
        .drag-over { border-top: 2px solid #00ffe0 !important; border-bottom: 1px dashed #444 !important; border-left: 1px dashed #444 !important; border-right: 1px dashed #444 !important; background-color: #353535 !important; }
        input[type="file"] { padding: 10px; cursor: pointer; background: #2a2a2a; }
        input[type="file"]::-webkit-file-upload-button { background: #444; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin-right: 10px; transition: background-color 0.2s; }
        input[type="file"]:hover::-webkit-file-upload-button { background: #555; }
        hr { border: none; border-top: 1px solid #333; margin: 25px 0; }
        h2.form-section-title { font-size: 1.3rem; color: #00ffe0; margin-top: 20px; margin-bottom: 10px; font-family: 'Orbitron', sans-serif; border-bottom: 1px solid #333; padding-bottom: 8px; }
        .faq-item { display: flex; flex-direction: column; gap: 10px; margin-bottom: 15px; padding: 15px; background: #252525; border-radius: 8px; border: 1px solid #444; }
        .faq-item input { flex-grow: 1; }
        #addFaqButton { background: #444; color: #fff; font-weight: normal; font-size: 0.9rem; padding: 8px 12px; margin-top: 0; cursor: pointer; border-radius: 5px; width: auto; transition: background-color 0.2s;}
        #addFaqButton:hover { background: #555; }
        .preview-note { font-size: 0.85rem; color: #888; text-align: center; margin-bottom: 15px; max-width: 600px;}
        @media (max-width: 768px) { h1.builder-title { font-size: 2rem; } }
    </style>
</head>
<body>
    <div id="navbar-placeholder"></div>

    <main id="builder-main">
         <h1 class="builder-title">Website Builder üõ†Ô∏è</h1>
         <p id="current-profile-indicator">Editing Profile: None</p>
         <p id="profile-required-message">Please select or create a profile using the top-right menu to save/load settings.</p>

        <div class="form" id="builderForm"> <h2 class="form-section-title">General Setup</h2>
             <div class="form-group"> <label for="coinName">Coin Name</label> <input id="coinName" placeholder="$COSMOPEPE" /> </div>
             <div class="form-group"> <label for="styleTheme">Overall Style Theme</label> <select id="styleTheme"> <option value="default">Default (Neon Tech)</option> <option value="sci-fi">Sci-Fi (Sharp & Futuristic)</option> <option value="cartoony">Cartoony (Rounded & Bold)</option> <option value="minimalist">Minimalist (Clean & Simple)</option> <option value="retro-pixel">Retro Pixel (8-Bit Style)</option> </select> </div>
             <div class="form-group"> <label for="colorTheme">Color Theme (Primary / Secondary)</label> <select id="colorTheme"> <option value="#00ffe0,#ff00ff">Neon (Teal + Magenta)</option> <option value="#facc15,#ef4444">Gold + Red</option> <option value="#4ade80,#06b6d4">Green + Aqua</option> <option value="#9333ea,#f472b6">Purple + Pink</option> <option value="#38bdf8,#22c55e">Sky + Lime</option> <option value="#f97316,#e11d48">Orange + Rose</option> <option value="#ffffff,#aaaaaa">Monochrome (White + Gray)</option> <option value="#ff5733,#c70039">Fiery (Orange + Dark Red)</option> <option value="#FFD700,#FFA500">Gold & Orange</option> <option value="#00FF00,#FFFF00">Lime & Yellow (Pixel)</option> </select> </div>
             <div class="form-group"> <label for="fontPair">Font Pairing (Heading / Body) - Theme might override</label> <select id="fontPair"> <option value="Orbitron,Poppins">Orbitron / Poppins</option> <option value="Press Start 2P,VT323">Press Start 2P / VT323</option> <option value="Montserrat,Lato">Montserrat / Lato</option> <option value="Roboto Slab,Roboto">Roboto Slab / Roboto</option> <option value="Bangers,Permanent Marker">Bangers / Permanent Marker</option> <option value="Aldrich,Rajdhani">Aldrich / Rajdhani (Sci-Fi)</option> <option value="Inter,Inter">Inter / Inter (Minimalist)</option> </select> </div>
             <hr/>
             <h2 class="form-section-title">Core Content & Header</h2>
             <div class="form-group"> <label for="tagline">Tagline</label> <input id="tagline" placeholder="The next intergalactic meme!" /> </div>
             <div class="form-group"> <label for="description">Main Description (Used in 'About' section)</label> <textarea id="description" placeholder="Explain your coin's unique story, mission, or meme power."></textarea> </div>
             <div class="form-group"> <label for="ctaText">Header CTA Button Text (Optional)</label> <input id="ctaText" placeholder="e.g., Buy $COSMOPEPE Now!" /> </div>
             <div class="form-group"> <label for="ctaLink">Header CTA Button Link (Optional)</label> <input id="ctaLink" type="url" placeholder="Link to DEX/exchange" /> </div>
             <div class="form-group"> <label for="whitepaperLink">Whitepaper Link (Optional - Adds a button/link)</label> <input id="whitepaperLink" type="url" placeholder="Link to your whitepaper PDF/doc" /> </div>
             <hr/>
             <h2 class="form-section-title">Website Structure & Elements</h2>
             <fieldset class="checkbox-group"> <legend>Toggle Website Elements:</legend> <div><input type="checkbox" id="includeNavbar" checked><label for="includeNavbar">Top Navigation Bar</label></div> <div><input type="checkbox" id="showTagline" checked><label for="showTagline">Show Tagline in Header</label></div> <div><input type="checkbox" id="showLogo" checked><label for="showLogo">Show Logo Below Content</label></div> <div><input type="checkbox" id="showFooterLinks" checked><label for="showFooterLinks">Show Social Links in Footer</label></div> <div><input type="checkbox" id="enableAnimations" checked><label for="enableAnimations">Enable Animations & Effects</label></div> </fieldset>
             <fieldset class="checkbox-group"> <legend>Include & Reorder Content Sections (Drag & Drop):</legend> <div id="section-list"> <div class="section-item" draggable="true" data-section-id="about"> <span class="drag-handle">‚ÜïÔ∏è</span> <input type="checkbox" id="includeAboutCheck" checked> <span>About Section</span> </div> <div class="section-item" draggable="true" data-section-id="how-to-buy"> <span class="drag-handle">‚ÜïÔ∏è</span> <input type="checkbox" id="includeHowToBuyCheck" checked> <span>How to Buy Section</span> </div> <div class="section-item" draggable="true" data-section-id="tokenomics"> <span class="drag-handle">‚ÜïÔ∏è</span> <input type="checkbox" id="includeTokenomicsCheck" checked> <span>Tokenomics Section</span> </div> <div class="section-item" draggable="true" data-section-id="roadmap"> <span class="drag-handle">‚ÜïÔ∏è</span> <input type="checkbox" id="includeRoadmapCheck" checked> <span>Roadmap Section</span> </div> <div class="section-item" draggable="true" data-section-id="team"> <span class="drag-handle">‚ÜïÔ∏è</span> <input type="checkbox" id="includeTeamCheck"> <span>Team Section (Optional)</span> </div> <div class="section-item" draggable="true" data-section-id="partners"> <span class="drag-handle">‚ÜïÔ∏è</span> <input type="checkbox" id="includePartnersCheck"> <span>Partners Section (Optional)</span> </div> <div class="section-item" draggable="true" data-section-id="faq"> <span class="drag-handle">‚ÜïÔ∏è</span> <input type="checkbox" id="includeFAQCheck"> <span>FAQ Section (Optional)</span> </div> <div class="section-item" draggable="true" data-section-id="community"> <span class="drag-handle">‚ÜïÔ∏è</span> <input type="checkbox" id="includeCommunityCheck" checked> <span>Community/Socials Section</span> </div> </div> </fieldset>
             <hr/>
             <h2 class="form-section-title">Section Content Details</h2>
             <div class="form-group"> <label for="howToBuyContent">How to Buy Steps (1 step per line)</label> <textarea id="howToBuyContent" placeholder="1. Get a Wallet (e.g., MetaMask)\n2. Buy Base Coin (e.g., ETH/SOL)\n3. Swap on DEX (e.g., Uniswap/Raydium)\nContract: 0x123..."></textarea> </div>
             <div class="form-group"> <label for="tokenomics">Tokenomics Details (1 item per line)</label> <textarea id="tokenomics" placeholder="Total Supply: 1 Trillion\nLiquidity: Burnt üî•\nTax: 0% Buy / 0% Sell\nOwnership: Renounced"></textarea> </div>
             <div class="form-group"> <label for="roadmap">Roadmap Phases (1 item per line)</label> <textarea id="roadmap" placeholder="Phase 1: Launch & Memetic Spread\nPhase 2: Listings & Influencers\nPhase 3: Utility Sneak Peek\nPhase 4: ???"></textarea> </div>
             <div class="form-group"> <label for="teamContent">Team Description (Optional, 1 member/role per line)</label> <textarea id="teamContent" placeholder="Lead Dev: Anon Chad\nMarketing Guru: Pepe Himself\nCommunity Mod: Based Wojak"></textarea> </div>
             <div class="form-group"> <label for="partnersContent">Partners (Optional, 1 partner per line - Name or simple text)</label> <textarea id="partnersContent" placeholder="Partner DEX\nCool NFT Project\nBased Influencer"></textarea> </div>
             <div class="form-group"> <label>FAQ Section Content (Optional)</label> <div id="faqList"> <div class="faq-item"> <label for="faq-q-1" class="sr-only">Question 1</label> <input type="text" id="faq-q-1" placeholder="Question 1" class="faq-q"> <label for="faq-a-1" class="sr-only">Answer 1</label> <input type="text" id="faq-a-1" placeholder="Answer 1" class="faq-a"> </div> </div> <button type="button" id="addFaqButton" onclick="addFaqItem()">+ Add FAQ Item</button> </div>
             <hr/>
             <h2 class="form-section-title">Branding & Socials</h2>
             <div class="form-group"> <label for="bannerImage">Banner Image (Re-upload if loading profile)</label> <input type="file" id="bannerImage" accept="image/*" /> </div>
             <div class="form-group"> <label for="logoImage">Logo Image (Re-upload if loading profile)</label> <input type="file" id="logoImage" accept="image/*" /> </div>
             <div class="form-group"> <label for="faviconImage">Favicon (Re-upload if loading profile)</label> <input type="file" id="faviconImage" accept="image/x-icon,image/png,image/vnd.microsoft.icon" /> </div>
             <div class="form-group"> <label for="telegram">Telegram Link</label> <input id="telegram" type="url" placeholder="https://t.me/yourcoin" /> </div>
             <div class="form-group"> <label for="twitter">Twitter/X Link</label> <input id="twitter" type="url" placeholder="https://twitter.com/yourcoin" /> </div>
             <div class="form-group"> <label for="discord">Discord Link (Optional)</label> <input id="discord" type="url" placeholder="https://discord.gg/yourserver" /> </div>
             <div class="form-group"> <label for="otherLink">Other Link (e.g., Reddit, Medium - Optional)</label> <input id="otherLink" type="url" placeholder="https://..." /> </div>
             <div class="form-group"> <label for="footerText">Custom Footer Text (Optional, short)</label> <input id="footerText" placeholder="e.g., For entertainment purposes only." /> </div>
             <hr/>
        </div> <div class="action-buttons">
            <button type="button" id="saveSettingsBtn">Save Settings for Current Profile</button>

            <button type="button" onclick="generatePreview()">Generate Preview</button>
            <button type="button" onclick="downloadSite()">Download Site File (HTML)</button>
        </div>

        <p class="preview-note">Note: Uploaded images (banner, logo, favicon) are NOT saved with the profile due to storage limits. You need to re-upload them when loading a profile. Settings ARE saved.</p>

        <iframe id="previewFrame" title="Website Preview"></iframe>

    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="js/profile-manager.js"></script>
    <script src="js/main.js"></script>

    <script>
        // --- Global Builder Variables ---
        let bannerData = '', logoData = '', faviconData = ''; // Image data is NOT saved/loaded
        const formElements = {}; // Object to easily access form elements
        const builderForm = document.getElementById('builderForm');
        const profileIndicator = document.getElementById('current-profile-indicator');
        const profileRequiredMessage = document.getElementById('profile-required-message');
        const saveSettingsButton = document.getElementById('saveSettingsBtn');

        // --- Helper to Get/Check Form Elements ---
        // Cache frequently accessed elements
        function cacheFormElements() {
             const ids = [
                 'coinName', 'styleTheme', 'colorTheme', 'fontPair', 'tagline', 'description',
                 'ctaText', 'ctaLink', 'whitepaperLink', 'includeNavbar', 'showTagline',
                 'showLogo', 'showFooterLinks', 'enableAnimations', 'howToBuyContent',
                 'tokenomics', 'roadmap', 'teamContent', 'partnersContent', 'telegram',
                 'twitter', 'discord', 'otherLink', 'footerText', 'faqList', 'section-list'
             ];
             ids.forEach(id => formElements[id] = document.getElementById(id));
             // Also get section checkboxes by a common attribute or querySelectorAll
             formElements.sectionCheckboxes = document.querySelectorAll('#section-list input[type="checkbox"]');
        }

        // Function to set enabled/disabled state of the form
        function setFormEnabled(isEnabled) {
             const elementsToToggle = builderForm.querySelectorAll('input, textarea, select, button:not(#saveSettingsBtn)'); // Exclude save button for now
             elementsToToggle.forEach(el => el.disabled = !isEnabled);
             // Specifically handle save button based on profile presence
             saveSettingsButton.disabled = !isEnabled;
             if(isEnabled) {
                 profileRequiredMessage.style.display = 'none';
             } else {
                  profileRequiredMessage.style.display = 'block';
             }
        }


        // --- Load & Save Profile Data ---

        function gatherBuilderSettings() {
            const settings = {};
            // General
            settings.coinName = formElements.coinName.value;
            settings.styleTheme = formElements.styleTheme.value;
            settings.colorTheme = formElements.colorTheme.value;
            settings.fontPair = formElements.fontPair.value;
            // Core
            settings.tagline = formElements.tagline.value;
            settings.description = formElements.description.value;
            settings.ctaText = formElements.ctaText.value;
            settings.ctaLink = formElements.ctaLink.value;
            settings.whitepaperLink = formElements.whitepaperLink.value;
            // Structure - Toggle Elements
            settings.includeNavbar = formElements.includeNavbar.checked;
            settings.showTagline = formElements.showTagline.checked;
            settings.showLogo = formElements.showLogo.checked; // Note: Logo data isn't saved
            settings.showFooterLinks = formElements.showFooterLinks.checked;
            settings.enableAnimations = formElements.enableAnimations.checked;
            // Structure - Sections
            settings.sectionOrder = Array.from(formElements['section-list'].children).map(item => item.dataset.sectionId);
            settings.includedSections = {};
            formElements.sectionCheckboxes.forEach(cb => {
                 // Find parent .section-item to get data-section-id
                 const sectionItem = cb.closest('.section-item');
                 if (sectionItem) {
                     settings.includedSections[sectionItem.dataset.sectionId] = cb.checked;
                 }
            });
            // Content
            settings.howToBuyContent = formElements.howToBuyContent.value;
            settings.tokenomics = formElements.tokenomics.value;
            settings.roadmap = formElements.roadmap.value;
            settings.teamContent = formElements.teamContent.value;
            settings.partnersContent = formElements.partnersContent.value;
            // FAQs
            settings.faqList = [];
            formElements.faqList.querySelectorAll('.faq-item').forEach(item => {
                const q = item.querySelector('.faq-q')?.value.trim();
                const a = item.querySelector('.faq-a')?.value.trim();
                if (q || a) { // Save even if one is empty, maybe user wants placeholder
                    settings.faqList.push({ q: q || "", a: a || "" });
                }
            });
             // Remove the initial template if empty and others exist
             if (settings.faqList.length > 1 && settings.faqList[0].q === "" && settings.faqList[0].a === "") {
                 // Only remove if it's the placeholder AND others were added
                 // This logic might need refinement based on how you want empty initial FAQ handled
             }

            // Socials
            settings.telegram = formElements.telegram.value;
            settings.twitter = formElements.twitter.value;
            settings.discord = formElements.discord.value;
            settings.otherLink = formElements.otherLink.value;
            settings.footerText = formElements.footerText.value;

            return settings;
        }

        function loadBuilderSettings(settings) {
            if (!settings) return; // Exit if no settings object provided

            console.log("Loading settings:", settings);

            // General
            formElements.coinName.value = settings.coinName || '';
            formElements.styleTheme.value = settings.styleTheme || 'default';
            formElements.colorTheme.value = settings.colorTheme || '#00ffe0,#ff00ff';
            formElements.fontPair.value = settings.fontPair || 'Orbitron,Poppins';
            // Core
            formElements.tagline.value = settings.tagline || '';
            formElements.description.value = settings.description || '';
            formElements.ctaText.value = settings.ctaText || '';
            formElements.ctaLink.value = settings.ctaLink || '';
            formElements.whitepaperLink.value = settings.whitepaperLink || '';
            // Structure - Toggle Elements
            formElements.includeNavbar.checked = settings.includeNavbar !== undefined ? settings.includeNavbar : true;
            formElements.showTagline.checked = settings.showTagline !== undefined ? settings.showTagline : true;
            formElements.showLogo.checked = settings.showLogo !== undefined ? settings.showLogo : true;
            formElements.showFooterLinks.checked = settings.showFooterLinks !== undefined ? settings.showFooterLinks : true;
            formElements.enableAnimations.checked = settings.enableAnimations !== undefined ? settings.enableAnimations : true;

            // Structure - Sections Order & Inclusion
            if (settings.sectionOrder && Array.isArray(settings.sectionOrder)) {
                 const sectionList = formElements['section-list'];
                 const itemsMap = new Map(); // Store items by ID
                 Array.from(sectionList.children).forEach(item => {
                     itemsMap.set(item.dataset.sectionId, item);
                 });

                 // Re-append in the saved order
                 settings.sectionOrder.forEach(sectionId => {
                      const itemToAppend = itemsMap.get(sectionId);
                      if (itemToAppend) {
                          sectionList.appendChild(itemToAppend); // Re-appending moves it
                      }
                 });
            }
            if (settings.includedSections) {
                formElements.sectionCheckboxes.forEach(cb => {
                    const sectionItem = cb.closest('.section-item');
                    if (sectionItem) {
                        const sectionId = sectionItem.dataset.sectionId;
                         // Default to checked if not specified in saved data, except for Team/Partners/FAQ
                         const defaultChecked = !['team', 'partners', 'faq'].includes(sectionId);
                         cb.checked = settings.includedSections[sectionId] !== undefined ? settings.includedSections[sectionId] : defaultChecked;
                    }
                });
            }

            // Content
            formElements.howToBuyContent.value = settings.howToBuyContent || '';
            formElements.tokenomics.value = settings.tokenomics || '';
            formElements.roadmap.value = settings.roadmap || '';
            formElements.teamContent.value = settings.teamContent || '';
            formElements.partnersContent.value = settings.partnersContent || '';
            // FAQs
            formElements.faqList.innerHTML = ''; // Clear existing FAQs
             if (settings.faqList && settings.faqList.length > 0) {
                  settings.faqList.forEach((faq, index) => {
                       addFaqItem(faq.q, faq.a, index + 1); // Pass initial values
                  });
             } else {
                  // Add one empty item if none loaded
                  addFaqItem('', '', 1);
             }


            // Socials
            formElements.telegram.value = settings.telegram || '';
            formElements.twitter.value = settings.twitter || '';
            formElements.discord.value = settings.discord || '';
            formElements.otherLink.value = settings.otherLink || '';
            formElements.footerText.value = settings.footerText || '';

            console.log("Settings applied.");
             // Optional: Trigger preview generation after load?
             // generatePreview();
        }

        function handleSaveSettings() {
             const currentProfile = getCurrentProfile();
             if (!currentProfile) {
                 alert("No profile selected. Please select or create a profile to save settings.");
                 return;
             }

             console.log(`Saving settings for profile: ${currentProfile}`);
             const settingsToSave = gatherBuilderSettings();
             const success = saveDataForCurrentProfile('websiteSettings', settingsToSave); // From profile-manager.js

             if (success) {
                 console.log("Settings saved successfully.");
                 saveSettingsButton.textContent = 'Settings Saved!';
                 saveSettingsButton.classList.add('saved');
                 setTimeout(() => {
                     saveSettingsButton.textContent = `Save Settings for ${currentProfile}`;
                     saveSettingsButton.classList.remove('saved');
                 }, 2000); // Reset button text after 2 seconds
             } else {
                  console.error("Failed to save settings.");
                  saveSettingsButton.textContent = 'Save Failed!';
                 // Alert was shown in profile manager if storage full
                  setTimeout(() => {
                     saveSettingsButton.textContent = `Save Settings for ${currentProfile}`;
                 }, 2000);
             }
        }


        // --- Existing Builder Functions ---
        function setupImageUpload(inputId, dataVariableSetter) { /* (Keep existing) */ const input = document.getElementById(inputId); input?.addEventListener('change', e => { if (e.target.files && e.target.files[0]) { toBase64(e.target.files[0], dataVariableSetter); } else { dataVariableSetter(''); } }); }
        function toBase64(file, callback) { /* (Keep existing) */ const reader = new FileReader(); reader.onload = () => callback(reader.result); reader.onerror = () => callback(''); reader.readAsDataURL(file); }
        let faqCounter = 0; // Reset counter based on loaded items
        function addFaqItem(initialQ = "", initialA = "", initialCount = -1) { // Accept initial values
            const list = formElements.faqList; // Use cached element
            faqCounter = (initialCount > 0) ? initialCount : list.children.length + 1; // Use provided count or calculate next
            const newItem = document.createElement('div'); newItem.className = 'faq-item';
            newItem.innerHTML = `<label for="faq-q-${faqCounter}" class="sr-only">Question ${faqCounter}</label><input type="text" id="faq-q-${faqCounter}" placeholder="Question ${faqCounter}" class="faq-q" value="${initialQ.replace(/"/g, '&quot;')}"><label for="faq-a-${faqCounter}" class="sr-only">Answer ${faqCounter}</label><input type="text" id="faq-a-${faqCounter}" placeholder="Answer ${faqCounter}" class="faq-a" value="${initialA.replace(/"/g, '&quot;')}">`;
            list.appendChild(newItem);
        }
        function generatePreview() { /* (Keep existing) */ const preview = document.getElementById("previewFrame"); preview.style.display = 'block'; preview.srcdoc = '<!DOCTYPE html><html><head><style>body{background:#111; color:#555; display:flex; justify-content:center; align-items:center; height:100vh; font-family: sans-serif;}p{border:1px solid #333; padding: 20px; border-radius: 5px;}</style></head><body><p>Generating Preview...</p></body></html>'; setTimeout(() => { try { const html = buildHTML(); preview.srcdoc = html; } catch (error) { console.error("Error generating preview:", error); preview.srcdoc = '<!DOCTYPE html><html><head><style>body{background:darkred; color:white; display:flex; justify-content:center; align-items:center; height:100vh; font-family: sans-serif;}p{border:1px solid #eee; padding: 20px; border-radius: 5px;}</style></head><body><p>Error generating preview. Check console.</p></body></html>'; } }, 0); }
        function downloadSite() { /* (Keep existing) */ try { const html = buildHTML(); const name = getValue('coinName').replace(/[^a-zA-Z0-9]/g, '') || 'memecoin'; const blob = new Blob([html], { type: "text/html;charset=utf-8" }); saveAs(blob, `${name}-website.html`); } catch (error) { console.error("Download Error:", error); alert("Error preparing download. Check console for details."); } }
        const fontUrlMap = { 'Orbitron': 'Orbitron:wght@400;600;900', 'Poppins': 'Poppins:wght@400;500;600', 'Press Start 2P': 'Press+Start+2P', 'VT323': 'VT323', 'Montserrat': 'Montserrat:wght@400;700', 'Lato': 'Lato:wght@400;700', 'Roboto Slab': 'Roboto+Slab:wght@400;700', 'Roboto': 'Roboto:wght@400;500', 'Bangers': 'Bangers', 'Permanent Marker': 'Permanent+Marker', 'Aldrich': 'Aldrich', 'Rajdhani': 'Rajdhani:wght@400;600', 'Inter': 'Inter:wght@400;500;700' };
        const themeDefaults = { 'default': { heading: 'Orbitron', body: 'Poppins'}, 'sci-fi': { heading: 'Aldrich', body: 'Rajdhani'}, 'cartoony': { heading: 'Bangers', body: 'Poppins'}, 'minimalist': { heading: 'Inter', body: 'Inter'}, 'retro-pixel': { heading: 'Press Start 2P', body: 'VT323'} };
        function buildHTML() { /* (Keep existing buildHTML function - it reads current form values) */ const name = formElements.coinName.value || 'Meme Coin'; const tagline = formElements.tagline.value || 'To the Moon!'; const styleTheme = formElements.styleTheme.value || 'default'; const colors = (formElements.colorTheme.value || '#00ffe0,#ff00ff').split(','); const selectedFontPair = (formElements.fontPair.value || 'Orbitron,Poppins').split(','); const footerText = formElements.footerText.value; const whitepaperLink = formElements.whitepaperLink.value; const enableAnimations = formElements.enableAnimations.checked; const showTagline = formElements.showTagline.checked; const showLogo = formElements.showLogo.checked; const showFooterLinks = formElements.showFooterLinks.checked; const includeNavbar = formElements.includeNavbar.checked; const ctaText = formElements.ctaText.value; const ctaLink = formElements.ctaLink.value; const telegram = formElements.telegram.value; const twitter = formElements.twitter.value; const discord = formElements.discord.value; const otherLink = formElements.otherLink.value; const description = formElements.description.value; const howToBuyRaw = formElements.howToBuyContent.value; const tokenomicsRaw = formElements.tokenomics.value; const roadmapRaw = formElements.roadmap.value; const teamRaw = formElements.teamContent.value; const partnersRaw = formElements.partnersContent.value; const faqItems = []; formElements.faqList.querySelectorAll('.faq-item').forEach(item => { const q = item.querySelector('.faq-q')?.value.trim(); const a = item.querySelector('.faq-a')?.value.trim(); if (q || a) { const sanitize = (str) => str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#039;'); faqItems.push({ q: sanitize(q || ""), a: sanitize(a || "") }); } }); let headingFont = themeDefaults[styleTheme]?.heading || 'Orbitron'; let bodyFont = themeDefaults[styleTheme]?.body || 'Poppins'; if (selectedFontPair.length === 2 && selectedFontPair[0] && selectedFontPair[1]) { headingFont = selectedFontPair[0]; bodyFont = selectedFontPair[1]; } const fontNames = [...new Set([headingFont, bodyFont])]; const googleFontParams = fontNames .map(fontName => fontUrlMap[fontName]) .filter(Boolean) .map(f => `family=${f.replace(/ /g, '+')}`) .join('&'); const googleFontLink = googleFontParams ? `<link href="https://fonts.googleapis.com/css2?${googleFontParams}&display=swap" rel="stylesheet">` : ''; const faviconHref = faviconData ? faviconData : (logoData ? logoData : 'favicon.ico'); const processList = (raw) => raw ? raw.split("\n").map(item => { const trimmed = item.trim(); const sanitized = trimmed.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#039;'); return `<li>${sanitized}</li>`; }).join('') : ''; const howToBuyList = processList(howToBuyRaw); const tokenomicsList = processList(tokenomicsRaw); const roadmapList = processList(roadmapRaw); const teamList = processList(teamRaw); const partnersList = processList(partnersRaw); const faqListHTML = faqItems.map(item => `<details><summary>${item.q}</summary><p>${item.a}</p></details>`).join(''); const sections = []; let contentSectionsHTML = ''; const sectionItems = formElements['section-list'].querySelectorAll('.section-item'); sectionItems.forEach(item => { const sectionId = item.dataset.sectionId; const checkbox = item.querySelector('input[type="checkbox"]'); const isIncluded = checkbox ? checkbox.checked : false; if (!isIncluded) return; let sectionTitle = '', content = '', icon = ''; switch(sectionId) { case 'about': if (!description) return; content = `<p>${description.replace(/\n/g, '<br>')}</p>`; icon = '‚ÑπÔ∏è'; sectionTitle = 'About'; break; case 'how-to-buy': if (!howToBuyList) return; content = `<ol>${howToBuyList.replace(/<li>/g, '<li class="step">')}</ol>`; icon = 'üõí'; sectionTitle = 'How to Buy'; break; case 'tokenomics': if (!tokenomicsList) return; content = `<ul>${tokenomicsList}</ul>`; icon = 'üìä'; sectionTitle = 'Tokenomics'; break; case 'roadmap': if (!roadmapList) return; content = `<ul>${roadmapList}</ul>`; icon = 'üó∫Ô∏è'; sectionTitle = 'Roadmap'; break; case 'team': if (!teamList) return; content = `<ul class="team-list">${teamList}</ul>`; icon = 'üßë‚Äçü§ù‚Äçüßë'; sectionTitle = 'Team'; break; case 'partners': if (!partnersList) return; content = `<ul class="partners-list">${partnersList}</ul>`; icon = 'ü§ù'; sectionTitle = 'Partners'; break; case 'faq': if (!faqListHTML) return; content = `<div class="faq-container">${faqListHTML}</div>`; icon = '‚ùì'; sectionTitle = 'FAQ'; break; case 'community': const socialLinksArr = [ { link: telegram, text: 'Telegram', icon: 'üí¨' }, { link: twitter, text: 'Twitter/X', icon: 'üê¶' }, { link: discord, text: 'Discord', icon: 'üéß' }, { link: otherLink, text: 'Community', icon: 'üîó' } ].filter(item => item.link); if (socialLinksArr.length === 0) return; content = `<div class="social-links">${socialLinksArr.map(sl => `<a href="${encodeURI(sl.link)}" target="_blank" class="social-button"><span class="social-icon">${sl.icon}</span> ${sl.text}</a>`).join('')}</div>`; icon = 'üåê'; sectionTitle = 'Community'; break;} if (sectionTitle) { sections.push({ id: sectionId, title: sectionTitle }); contentSectionsHTML += `<section id="${sectionId}"><h3><span class="section-icon">${icon}</span> ${sectionTitle}</h3>${content}</section>\n`; } }); const navbarHTML = includeNavbar ? `<nav class="navbar"> <div class="nav-container"> <a href="#" class="nav-brand">${name}</a> <ul class="nav-links"> ${sections.map(s => `<li><a href="#${s.id}">${s.title}</a></li>`).join('')} ${whitepaperLink ? `<li><a href="${encodeURI(whitepaperLink)}" target="_blank" class="nav-button">Whitepaper</a></li>` : ''} </ul> <button class="nav-toggle" aria-label="Toggle navigation">‚ò∞</button> </div> </nav>` : ''; const headerSection = ` <header> ${bannerData ? `<img src="${bannerData}" class="banner" alt="Banner" loading="lazy" />` : ''} <h1>${name}</h1> ${showTagline ? `<h2>${tagline.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</h2>` : ''} <div class="header-buttons"> ${ctaText && ctaLink ? `<a href="${encodeURI(ctaLink)}" target="_blank" class="cta-button primary-cta">${ctaText.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</a>` : ''} ${whitepaperLink && !includeNavbar ? `<a href="${encodeURI(whitepaperLink)}" target="_blank" class="cta-button secondary-cta">Whitepaper</a>` : ''} </div> </header>`; const logoHTML = showLogo && logoData ? `<div class="logo-container"><img src="${logoData}" class="logo" alt="${name} Logo" loading="lazy" /></div>` : ''; const footerSocialLinks = [ { link: telegram, text: 'Telegram'}, { link: twitter, text: 'Twitter/X'}, { link: discord, text: 'Discord'}, { link: otherLink, text: 'Other'} ].filter(item => item.link); const sanitizedFooterText = footerText ? `<p class="footer-disclaimer">${footerText.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</p>` : ''; const footerLinksHTML = showFooterLinks && footerSocialLinks.length > 0 ? `<p class="footer-links">${footerSocialLinks.map(sl => `<a href="${encodeURI(sl.link)}" target="_blank">${sl.text}</a>`).join(' | ')}</p>` : ''; const footerSection = `<footer><p>¬© ${new Date().getFullYear()} ${name}. All Rights Reserved.</p>${sanitizedFooterText}${footerLinksHTML}</footer>`; return `<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="description" content="${tagline.replace(/"/g, '&quot;')} - Join the ${name} meme coin!"><meta name="keywords" content="${name}, meme coin, crypto, token, ${tagline.split(' ').filter(w => w.length > 2).join(', ')}"><title>${name} - ${tagline || 'Meme Coin'}</title>${googleFontLink}<link rel="icon" href="${faviconHref}"><style>:root{--font-heading:'${headingFont}',sans-serif;--font-body:'${bodyFont}',sans-serif;--color-primary:${colors[0]};--color-secondary:${colors[1]};--color-primary-transparent:${colors[0]}20;--color-secondary-transparent:${colors[1]}20;--color-primary-shadow:${colors[0]}80;--color-secondary-shadow:${colors[1]}80;--background-color:#0a0a0a;--text-color:#fff;--text-color-muted:#ccc;--card-background:rgba(18,18,18,0.85);--card-border:#222;--border-radius-small:5px;--border-radius-medium:10px;--border-radius-large:15px;--shadow-color:rgba(0,0,0,0.6);--shadow-light:0 4px 15px var(--shadow-color);--shadow-medium:0 8px 30px var(--shadow-color);--header-overlay:linear-gradient(rgba(10,10,10,0.7),rgba(10,10,10,0.9))}*{margin:0;padding:0;box-sizing:border-box;scroll-behavior:smooth}body{font-family:var(--font-body);background-color:var(--background-color);color:var(--text-color);line-height:1.7;overflow-x:hidden;position:relative;-webkit-overflow-scrolling:touch;overflow-y:scroll}html,body{height:100%}body.animations-disabled *{animation:none!important;transition:none!important}.logo{width:clamp(100px,20vw,150px);border-radius:50%;border:4px solid var(--color-primary);box-shadow:0 0 25px var(--color-primary-shadow);transition:all .5s ease;display:inline-block;background-color:#111}body:not(.animations-disabled) .logo{animation:spinGlow 8s linear infinite alternate}.logo:hover{transform:scale(1.1);box-shadow:0 0 40px var(--color-secondary-shadow)}.logo-container{text-align:center;padding:2rem 0;margin-top:2rem}h1,h2,h3{font-family:var(--font-heading);line-height:1.3}h1{font-size:clamp(2.5rem,10vw,5.5rem);font-weight:900}h2{font-size:clamp(1.2rem,5vw,2rem);font-weight:400;color:var(--text-color-muted);margin-bottom:1.5rem}h3{font-size:clamp(1.8rem,6vw,2.8rem);color:var(--color-primary);margin-bottom:2rem;position:relative;padding-bottom:.5rem;border-bottom:2px solid var(--color-primary-transparent);display:inline-block}h3 .section-icon{margin-right:10px;display:inline-block}p{margin-bottom:1rem;color:var(--text-color-muted)}a{color:var(--color-secondary);text-decoration:none;transition:color .3s ease}a:hover{color:var(--color-primary)}ul,ol{list-style:none;padding-left:0}section ul li,section ol li{position:relative;padding:.8rem 0 .8rem 35px;border-bottom:1px solid rgba(255,255,255,.1);margin-bottom:.5rem}section ul li:last-child,section ol li:last-child{border-bottom:none}section ul li::before{content:'¬ª';position:absolute;left:5px;top:50%;transform:translateY(-50%);font-size:1.4rem;color:var(--color-primary);font-weight:700}ol{counter-reset:step-counter}ol li.step{padding-left:45px}ol li.step::before{content:counter(step-counter);counter-increment:step-counter;position:absolute;left:5px;top:50%;transform:translateY(-50%);width:25px;height:25px;line-height:25px;text-align:center;border-radius:50%;background:var(--color-primary);color:#000;font-size:.9rem;font-weight:700;font-family:var(--font-body)}.content{max-width:1100px;margin:-50px auto 0;padding:3rem 1.5rem;position:relative;z-index:3;display:flex;flex-direction:column;gap:4rem}section{padding:3rem clamp(1rem,5vw,3rem);background:var(--card-background);border-radius:var(--border-radius-large);box-shadow:var(--shadow-medium);border:1px solid var(--card-border);backdrop-filter:blur(5px);-webkit-backdrop-filter:blur(5px);position:relative;overflow:hidden}.navbar{background:rgba(10,10,10,.8);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);padding:1rem 2rem;position:fixed;top:0;left:0;width:100%;z-index:100;border-bottom:1px solid var(--card-border);box-shadow:var(--shadow-light);transition:padding .3s ease}.navbar .nav-container{display:flex;justify-content:space-between;align-items:center;max-width:1200px;margin:0 auto}.navbar .nav-brand{font-family:var(--font-heading);font-size:1.5rem;color:var(--color-primary);font-weight:700}.navbar .nav-links{display:flex;gap:1.5rem;align-items:center;list-style:none;margin:0;padding:0}.navbar .nav-links a{color:var(--text-color-muted);font-weight:500}.navbar .nav-links a:hover{color:var(--color-primary)}.navbar .nav-button{background:var(--color-secondary);color:#000;padding:.5rem 1rem;border-radius:var(--border-radius-small);font-weight:700;transition:transform .2s ease,background .3s ease}.navbar .nav-button:hover{background:var(--color-primary);transform:scale(1.05)}.navbar .nav-toggle{display:none;background:0 0;border:1px solid #555;color:#ccc;font-size:1.8rem;padding:2px 8px;border-radius:4px;cursor:pointer;line-height:1}body.nav-active{padding-top:70px}header{position:relative;min-height:70vh;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:5rem 2rem;overflow:hidden;background:var(--header-overlay)}body.nav-active header{margin-top:-70px}header img.banner{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;z-index:-1;filter:brightness(.6);opacity:.8}header h1{color:var(--color-primary);text-shadow:0 0 20px var(--color-primary-shadow),0 0 35px var(--color-secondary-shadow);margin:1rem 0;z-index:2;animation:glow 2.5s ease-in-out infinite alternate}body.animations-disabled header h1{animation:none}header h2{text-shadow:1px 1px 10px rgba(0,0,0,.7);z-index:2;max-width:800px;animation:fadeInUp 1s ease-out forwards;opacity:0}body.animations-disabled header h2{opacity:1;animation:none}.header-buttons{margin-top:1.5rem;display:flex;gap:1rem;flex-wrap:wrap;justify-content:center;z-index:2}.cta-button{font-family:var(--font-heading);color:#000;padding:15px 35px;border-radius:50px;text-decoration:none;font-size:clamp(1rem,4vw,1.3rem);font-weight:600;transition:transform .3s ease,box-shadow .3s ease;display:inline-block;border:none}.cta-button.primary-cta{background:linear-gradient(45deg,var(--color-primary),var(--color-secondary));box-shadow:0 5px 25px var(--color-primary-shadow)}.cta-button.secondary-cta{background:var(--text-color-muted);color:#000;box-shadow:0 3px 15px rgba(0,0,0,.4)}.cta-button:hover{transform:scale(1.08)}.cta-button.primary-cta:hover{box-shadow:0 8px 35px var(--color-secondary-shadow)}.cta-button.secondary-cta:hover{background:var(--text-color)}section[id=tokenomics] ul li::before{content:'üìä'}section[id=roadmap] ul li::before{content:'üöÄ'}section[id=team] .team-list li::before{content:'üë§'}section[id=partners] .partners-list li::before{content:'ü§ù'}section[id=faq] .faq-container{display:flex;flex-direction:column;gap:1rem}section[id=faq] details{background:rgba(255,255,255,.05);border-radius:var(--border-radius-medium);border:1px solid rgba(255,255,255,.1);transition:background-color .2s ease}section[id=faq] details:hover{background:rgba(255,255,255,.08)}section[id=faq] summary{padding:1rem;cursor:pointer;font-weight:700;color:var(--color-primary);list-style-type:'‚ùì '}section[id=faq] details[open] summary{list-style-type:'‚ùï ';color:var(--color-secondary)}section[id=faq] details p{padding:0 1rem 1rem;border-top:1px solid rgba(255,255,255,.1);margin-top:.5rem;color:var(--text-color-muted)}section[id=community]{text-align:center}section[id=community] .social-links{display:flex;justify-content:center;gap:1.5rem;flex-wrap:wrap;margin-top:1.5rem}.social-button{color:#0a0a0a;font-weight:600;text-decoration:none;padding:.8rem 1.8rem;background:linear-gradient(45deg,var(--color-primary),var(--color-secondary));border-radius:50px;transition:all .3s ease;box-shadow:0 0 15px var(--color-primary-shadow);font-family:var(--font-heading);font-size:clamp(.9rem,3vw,1.1rem);text-transform:uppercase;border:2px solid transparent;display:inline-flex;align-items:center;gap:8px}.social-button:hover{transform:translateY(-5px) scale(1.05);box-shadow:0 5px 25px var(--color-secondary-shadow);background:linear-gradient(45deg,var(--color-secondary),var(--color-primary))}.social-icon{display:inline-block}footer{background:#050505;padding:2.5rem 1rem;text-align:center;border-top:3px solid var(--color-primary);margin-top:4rem}footer p{font-size:clamp(.9rem,2.5vw,1rem);color:#aaa;margin-bottom:.8rem}footer p.footer-disclaimer{font-size:.85rem;color:#777;font-style:italic}footer .footer-links a{margin:0 8px;color:#aaa}footer .footer-links a:hover{color:var(--color-secondary)}@keyframes glow{0%{text-shadow:0 0 15px var(--color-primary-shadow),0 0 25px var(--color-secondary-shadow)}to{text-shadow:0 0 25px var(--color-primary-shadow),0 0 40px var(--color-secondary-shadow)}}@keyframes fadeInUp{0%{opacity:0;transform:translateY(25px)}to{opacity:1;transform:translateY(0)}}@keyframes spinGlow{0%{transform:rotate(0);box-shadow:0 0 25px var(--color-primary-shadow);border-color:var(--color-primary)}50%{transform:rotate(180deg);box-shadow:0 0 35px var(--color-secondary-shadow);border-color:var(--color-secondary)}to{transform:rotate(360deg);box-shadow:0 0 25px var(--color-primary-shadow);border-color:var(--color-primary)}}@media (max-width:768px){body.nav-active{padding-top:60px}.navbar{padding:.8rem 1rem}.navbar .nav-container{flex-wrap:wrap}.navbar .nav-links{display:none;flex-direction:column;width:100%;align-items:center;background:rgba(10,10,10,.98);position:absolute;top:100%;left:0;padding:1rem 0;border-top:1px solid var(--card-border);box-shadow:0 5px 10px rgba(0,0,0,.3)}.navbar.nav-open .nav-links{display:flex}.navbar .nav-links li{width:100%;text-align:center}.navbar .nav-links a{padding:.8rem 1rem;width:100%;border-bottom:1px solid #222}.navbar .nav-links li:last-child a{border-bottom:none}.navbar .nav-button{width:calc(100% - 2rem);margin:.5rem 1rem;text-align:center}.navbar .nav-toggle{display:block}header{min-height:60vh;padding:4rem 1rem}body.nav-active header{margin-top:-60px}.content{margin-top:-30px;padding:2rem 1rem;gap:2.5rem}section{padding:2rem}h1{font-size:2.5rem}h2{font-size:1.3rem}h3{font-size:1.8rem}.cta-button{padding:12px 30px;font-size:1.1rem}.social-button{padding:.7rem 1.5rem;font-size:.9rem}}@media (max-width:480px){h1{font-size:2.2rem}h2{font-size:1.1rem}h3{font-size:1.6rem}.cta-button{padding:10px 25px;font-size:1rem}.social-button{padding:.6rem 1.2rem;font-size:.8rem}section{padding:1.5rem}}.theme-sci-fi{--border-radius-small:2px;--border-radius-medium:4px;--border-radius-large:6px;--card-background:rgba(10,15,30,.85);--card-border:rgba(var(--color-primary),.3);--shadow-medium:0 0 20px rgba(var(--color-primary),.2)}.theme-sci-fi h3{border-bottom-style:solid;border-image:linear-gradient(to right,var(--color-primary),transparent) 1;text-transform:uppercase;letter-spacing:1px}.theme-sci-fi section{border-radius:var(--border-radius-large);border:1px solid var(--card-border);box-shadow:inset 0 0 10px rgba(var(--color-secondary),.1)}.theme-sci-fi .cta-button,.theme-sci-fi .navbar .nav-button,.theme-sci-fi .social-button{border-radius:var(--border-radius-small);text-transform:uppercase;letter-spacing:.5px;box-shadow:0 0 10px var(--color-primary-shadow)}.theme-sci-fi .logo{border-radius:var(--border-radius-medium);border-width:2px;animation:none!important;box-shadow:0 0 15px var(--color-primary-shadow)}.theme-sci-fi ol li.step::before{border-radius:var(--border-radius-small)}.theme-cartoony{--border-radius-small:10px;--border-radius-medium:20px;--border-radius-large:30px;--card-background:rgba(30,30,30,.9);--card-border:#444}.theme-cartoony h3{font-weight:700;border-bottom:3px solid var(--color-primary-transparent);color:var(--color-primary);text-shadow:1px 1px 0 #000,-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000}.theme-cartoony section{border-radius:var(--border-radius-large);border:3px solid #111;box-shadow:5px 5px 0 rgba(0,0,0,.3)}.theme-cartoony .cta-button,.theme-cartoony .navbar .nav-button,.theme-cartoony .social-button{border-radius:50px;font-weight:700;border:3px solid #000;box-shadow:4px 4px 0 rgba(0,0,0,.5);transition:transform .15s ease-out,box-shadow .15s ease-out}.theme-cartoony .cta-button:hover,.theme-cartoony .navbar .nav-button:hover,.theme-cartoony .social-button:hover{transform:translate(2px,2px);box-shadow:2px 2px 0 rgba(0,0,0,.5)}.theme-cartoony .logo{border-radius:50%;border-width:5px;border-color:var(--color-primary)}.theme-cartoony ol li.step::before,.theme-cartoony section ul li::before{transform:translateY(-50%) scale(1.1)}.theme-cartoony #faq details{border-width:2px;border-color:#333}.theme-cartoony #faq summary{text-shadow:1px 1px 0 #000}.theme-minimalist{--border-radius-small:3px;--border-radius-medium:5px;--border-radius-large:8px;--card-background:#121212;--card-border:#333;--shadow-light:none;--shadow-medium:none;--header-overlay:rgba(10,10,10,.8)}.theme-minimalist h1{text-shadow:none;animation:none!important}.theme-minimalist h2{font-weight:400}.theme-minimalist h3{font-weight:500;color:var(--text-color);border-bottom:1px solid var(--card-border);padding-bottom:.3rem;letter-spacing:.5px}.theme-minimalist section{box-shadow:none;border-radius:var(--border-radius-medium);backdrop-filter:none;-webkit-backdrop-filter:none;background:var(--card-background)}.theme-minimalist .cta-button,.theme-minimalist .navbar .nav-button,.theme-minimalist .social-button{border-radius:var(--border-radius-small);box-shadow:none;background:var(--color-primary);color:#000;font-weight:500;transition:background-color .2s ease;text-transform:none;padding:12px 25px}.theme-minimalist .cta-button:hover,.theme-minimalist .navbar .nav-button:hover,.theme-minimalist .social-button:hover{background:var(--color-secondary);transform:none}.theme-minimalist .navbar{background:#0a0a0a;backdrop-filter:none;-webkit-backdrop-filter:none}.theme-minimalist footer{border-top-color:#333}.theme-minimalist .logo{border-radius:var(--border-radius-medium);border-width:2px;border-color:#555;box-shadow:none;animation:none!important}.theme-minimalist #faq details,.theme-minimalist ol li.step::before,.theme-minimalist section ul li::before{font-size:1rem;color:#888}.theme-minimalist #faq details{border-color:#333;background:#1a1a1a}.theme-minimalist #faq summary{color:var(--text-color)}.theme-retro-pixel{--border-radius-small:0;--border-radius-medium:0;--border-radius-large:0;--card-background:rgba(10,10,10,.95);--card-border:var(--color-primary);image-rendering:pixelated;image-rendering:-moz-crisp-edges;image-rendering:crisp-edges}.theme-retro-pixel body{font-family:'VT323',monospace!important}.theme-retro-pixel .cta-button,.theme-retro-pixel .navbar .nav-brand,.theme-retro-pixel .navbar .nav-button,.theme-retro-pixel .social-button,.theme-retro-pixel h1,.theme-retro-pixel h2,.theme-retro-pixel h3{font-family:'Press Start 2P',cursive!important}.theme-retro-pixel h1{font-size:clamp(1.8rem,8vw,3.5rem);text-shadow:3px 3px 0 var(--color-secondary),-3px -3px 0 rgba(0,0,0,.5);animation:none!important}.theme-retro-pixel h2{font-size:clamp(1rem,4vw,1.5rem);color:#bbb;text-shadow:1px 1px 0 #000}.theme-retro-pixel h3{font-size:clamp(1.3rem,5vw,1.8rem);color:var(--color-primary);text-shadow:2px 2px 0 #000;border-bottom:3px solid var(--color-secondary);padding-bottom:5px;text-transform:uppercase}.theme-retro-pixel section{border-radius:0;border:3px solid var(--card-border);box-shadow:6px 6px 0 rgba(0,0,0,.6);backdrop-filter:none;-webkit-backdrop-filter:none}.theme-retro-pixel .cta-button,.theme-retro-pixel .navbar .nav-button,.theme-retro-pixel .social-button{border-radius:0;background:var(--color-primary);color:#000;box-shadow:3px 3px 0 var(--color-secondary);border:2px solid #000;padding:10px 20px;font-size:clamp(.7rem,2.5vw,.9rem);transition:transform .1s linear,box-shadow .1s linear;text-transform:uppercase}.theme-retro-pixel .cta-button:hover,.theme-retro-pixel .navbar .nav-button:hover,.theme-retro-pixel .social-button:hover{transform:translate(1px,1px);box-shadow:2px 2px 0 var(--color-secondary)}.theme-retro-pixel .navbar{border-bottom-width:3px;border-bottom-color:var(--color-secondary)}.theme-retro-pixel footer{border-top-width:4px;border-top-color:var(--color-secondary)}.theme-retro-pixel .logo{border-radius:0;border-width:3px;border-color:var(--color-secondary);box-shadow:4px 4px 0 rgba(0,0,0,.5);animation:none!important}.theme-retro-pixel ol li.step::before,.theme-retro-pixel section ul li::before{font-family:'VT323',monospace;font-weight:400;color:var(--color-primary);background:0 0;border:1px solid var(--color-primary);width:18px;height:18px;line-height:18px;font-size:.8rem}.theme-retro-pixel section ul li::before{content:'*';border:none}.theme-retro-pixel #faq details{border-width:2px;border-color:var(--color-secondary)}.theme-retro-pixel #faq summary{text-shadow:1px 1px 0 #000}</style></head><body class="theme-${styleTheme} ${enableAnimations?'':'animations-disabled'} ${includeNavbar?'nav-active':''}">${navbarHTML}${headerSection}<main class="content">${contentSectionsHTML}</main>${logoHTML}${footerSection}${includeNavbar?`<script>const navToggle=document.querySelector('.navbar .nav-toggle'),navMenu=document.querySelector('.navbar');navToggle&&navMenu&&(navToggle.addEventListener('click',()=>{navMenu.classList.toggle('nav-open')}),navMenu.querySelectorAll('.nav-links a').forEach(e=>{e.addEventListener('click',()=>{navMenu.classList.contains('nav-open')&&navMenu.classList.remove('nav-open')})}));<\/script>`:''}</body></html>`; }

¬† ¬† ¬† ¬† // --- Generate Preview ---
¬† ¬† ¬† ¬† function generatePreview() { /* (Keep existing function) */ const preview = document.getElementById("previewFrame"); preview.style.display = 'block'; preview.srcdoc = '<!DOCTYPE html><html><head><style>body{background:#111; color:#555; display:flex; justify-content:center; align-items:center; height:100vh; font-family: sans-serif;}p{border:1px solid #333; padding: 20px; border-radius: 5px;}</style></head><body><p>Generating Preview...</p></body></html>'; setTimeout(() => { try { const html = buildHTML(); preview.srcdoc = html; } catch (error) { console.error("Error generating preview:", error); preview.srcdoc = '<!DOCTYPE html><html><head><style>body{background:darkred; color:white; display:flex; justify-content:center; align-items:center; height:100vh; font-family: sans-serif;}p{border:1px solid #eee; padding: 20px; border-radius: 5px;}</style></head><body><p>Error generating preview. Check console.</p></body></html>'; } }, 0); }

¬† ¬† ¬† ¬† // --- Download Site ---
¬† ¬† ¬† ¬† function downloadSite() { /* (Keep existing function) */ try { const html = buildHTML(); const name = formElements.coinName.value.replace(/[^a-zA-Z0-9]/g, '') || 'memecoin'; const blob = new Blob([html], { type: "text/html;charset=utf-8" }); saveAs(blob, `${name}-website.html`); } catch (error) { console.error("Download Error:", error); alert("Error preparing download. Check console for details."); } }

¬† ¬† ¬† ¬† // --- Drag and Drop Logic ---
¬† ¬† ¬† ¬† const sectionListContainer = formElements['section-list']; // Use cached element
¬† ¬† ¬† ¬† let draggedItem = null;
¬† ¬† ¬† ¬† if (sectionListContainer) { // Check if element exists
¬† ¬† ¬† ¬† ¬† ¬† sectionListContainer.addEventListener('dragstart', (e) => { const targetItem = e.target.closest('.section-item'); if (!targetItem || !e.target.classList.contains('drag-handle')) { e.preventDefault(); return; } draggedItem = targetItem; setTimeout(() => { if(draggedItem) draggedItem.classList.add('dragging'); }, 0); });
¬† ¬† ¬† ¬† ¬† ¬† sectionListContainer.addEventListener('dragend', (e) => { if (draggedItem) { draggedItem.classList.remove('dragging'); } draggedItem = null; const items = sectionListContainer.querySelectorAll('.section-item'); items.forEach(item => item.classList.remove('drag-over')); });
¬† ¬† ¬† ¬† ¬† ¬† sectionListContainer.addEventListener('dragover', (e) => { e.preventDefault(); const container = sectionListContainer; if (!draggedItem) return; const afterElement = getDragAfterElement(container, e.clientY); const currentOver = container.querySelector('.drag-over'); const targetItem = e.target.closest('.section-item'); if (targetItem && targetItem !== draggedItem && targetItem !== currentOver) { if(currentOver) currentOver.classList.remove('drag-over'); targetItem.classList.add('drag-over'); } else if (!targetItem && currentOver) { currentOver.classList.remove('drag-over'); } if (afterElement == null) { container.appendChild(draggedItem); } else { container.insertBefore(draggedItem, afterElement); } });
¬† ¬† ¬† ¬† ¬† ¬† sectionListContainer.addEventListener('dragenter', (e) => { e.preventDefault(); });
¬† ¬† ¬† ¬† ¬† ¬† sectionListContainer.addEventListener('dragleave', (e) => { const related = e.relatedTarget; if (!sectionListContainer.contains(related)) { const currentOver = sectionListContainer.querySelector('.drag-over'); if(currentOver) currentOver.classList.remove('drag-over'); } });
¬† ¬† ¬† ¬† ¬† ¬† sectionListContainer.addEventListener('drop', (e) => { e.preventDefault(); const currentOver = sectionListContainer.querySelector('.drag-over'); if (currentOver) { currentOver.classList.remove('drag-over'); } });
¬† ¬† ¬† ¬† }
¬† ¬† ¬† ¬† function getDragAfterElement(container, y) { const draggableElements = [...container.querySelectorAll('.section-item:not(.dragging)')]; return draggableElements.reduce((closest, child) => { const box = child.getBoundingClientRect(); const offset = y - box.top - box.height / 2; if (offset < 0 && offset > closest.offset) { return { offset: offset, element: child }; } else { return closest; } }, { offset: Number.NEGATIVE_INFINITY }).element; }

¬† ¬† ¬† ¬† // --- Initialization ---
¬† ¬† ¬† ¬† function initializeBuilder() {
¬† ¬† ¬† ¬† ¬† ¬† cacheFormElements(); // Get references to form elements
¬† ¬† ¬† ¬† ¬† ¬† const currentProfile = getCurrentProfile(); // From profile-manager.js
¬† ¬† ¬† ¬† ¬† ¬† const profileIndicator = document.getElementById('current-profile-indicator');
¬† ¬† ¬† ¬† ¬† ¬† const profileRequiredMessage = document.getElementById('profile-required-message');
¬† ¬† ¬† ¬† ¬† ¬† const saveBtn = document.getElementById('saveSettingsBtn');

¬† ¬† ¬† ¬† ¬† ¬† if (profileIndicator) {
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† profileIndicator.textContent = `Editing Profile: ${currentProfile || 'None (Please Select/Create)'}`;
¬† ¬† ¬† ¬† ¬† ¬† }

¬† ¬† ¬† ¬† ¬† ¬† if (currentProfile) {
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† setFormEnabled(true); // Enable form if profile selected
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† console.log(`Loading settings for profile: ${currentProfile}`);
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† const profileData = getProfileData(currentProfile); // From profile-manager.js
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† if (profileData && profileData.websiteSettings) {
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† loadBuilderSettings(profileData.websiteSettings);
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† } else {
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† console.log("No existing website settings found for this profile. Using defaults.");
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† // Optionally reset form to defaults if needed, but loadBuilderSettings handles missing keys
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† loadBuilderSettings({}); // Load with empty object to apply defaults
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† }
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† if (saveBtn) {
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† saveBtn.textContent = `Save Settings for ${currentProfile}`;
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† saveBtn.onclick = handleSaveSettings; // Assign save function
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† }
¬† ¬† ¬† ¬† ¬† ¬† } else {
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† setFormEnabled(false); // Disable form if no profile selected
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† console.log("No profile selected.");
¬† ¬† ¬† ¬† ¬† ¬† }

¬† ¬† ¬† ¬† ¬† ¬† // Setup image uploads (only needs to be done once)
¬† ¬† ¬† ¬† ¬† ¬† setupImageUpload('bannerImage', d => bannerData = d);
¬† ¬† ¬† ¬† ¬† ¬† setupImageUpload('logoImage', d => logoData = d);
¬† ¬† ¬† ¬† ¬† ¬† setupImageUpload('faviconImage', d => faviconData = d);
¬† ¬† ¬† ¬† }

¬† ¬† ¬† ¬† // Run initialization after the DOM is ready AND navigation (which initializes profile manager) is potentially loaded
¬† ¬† ¬† ¬† // We rely on main.js running first due to script order in HTML
¬† ¬† ¬† ¬† if (document.readyState === 'loading') {
¬† ¬† ¬† ¬† ¬† ¬† document.addEventListener('DOMContentLoaded', initializeBuilder);
¬† ¬† ¬† ¬† } else {
¬† ¬† ¬† ¬† ¬† ¬† initializeBuilder(); // DOM is already ready
¬† ¬† ¬† ¬† }

¬† ¬† </script>
</body>
</html>